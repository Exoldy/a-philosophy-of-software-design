<!DOCTYPE html>
<html lang="ru-RU" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10. Ошибок не существует (Define Errors Out of Existence) | Философия дизайна ПО</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/assets/style.CSPm08Rv.css" as="style">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/vp-icons.css" as="style">
    
    <script type="module" src="/a-philosophy-of-software-design/assets/app.DVEU4zNL.js"></script>
    <link rel="preload" href="/a-philosophy-of-software-design/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/theme.DDW5w42F.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/framework.CM3gOIkZ.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/define-errors-out-of-existence.md.B-jsikCf.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/a-philosophy-of-software-design/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Философия дизайна ПО</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/preface.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Предисловие</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/introduction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>1. Введение</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/the-nature-of-complexity.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>2. Суть всей боли (Природа Сложности)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/working-code-is-not-enough.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>3. "Работает — и ладно" — девиз неудачников</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>4. Глубокие модули</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/information-hiding-and-leakage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>5. Прячем говно под ковер</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6. Универсальность модулей</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/different-layer-different-abstraction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>7. Разные слои — разные абстракции</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/pull-complexity-downwards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>8. Скидывай сложность вниз</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/better-together-or-better-apart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>9. Вместе или порознь?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/define-errors-out-of-existence.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10. Ошибок не существует</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/design-it-twice.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11. Проектируй дважды</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/why-write-comments-the-four-excuses.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12. Зачем писать комменты?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/comments-should-describe-things-that-are-not-obvious-from-the-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13. Комментируй то, что не очевидно</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/choosing-names.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14. Нейминг</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15. Сначала комменты, потом код</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modifying-existing-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16. Трогаем старый код</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/consistency.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17. Консистентность</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/code-should-be-obvious.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18. Код должен быть понятен даже ежу</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/software-trends.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19. Модные молодежные тренды</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/designing-for-performance.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20. Производительность</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/decide-what-matters.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21. Определись, что важно</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/conclusion.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22. Заключение</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/summary.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Шпаргалка</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _a-philosophy-of-software-design_define-errors-out-of-existence" data-v-39a288b8><div><h1 id="_10-ошибок-не-существует-define-errors-out-of-existence" tabindex="-1"><strong>10. Ошибок не существует (Define Errors Out of Existence)</strong> <a class="header-anchor" href="#_10-ошибок-не-существует-define-errors-out-of-existence" aria-label="Permalink to &quot;**10. Ошибок не существует (Define Errors Out of Existence)**&quot;">​</a></h1><p>Обработка исключений — это один из самых жирных источников сложности в софте. Код, который разгребает дерьмо (особые условия), писать сложнее, чем код, который просто делает работу. Разработчики часто объявляют исключения, вообще не отдупляя, как их потом будут обрабатывать. Эта глава пояснит, почему исключения — это зло, и покажет, как сделать так, чтобы их было поменьше.</p><p><strong>Спойлер:</strong> Главная мысль главы — сократи количество мест, где нужно подтирать за кодом. В идеале — измени семантику операций так, чтобы &quot;ошибок&quot; тупо не существовало.</p><h2 id="_10-1-почему-exception-увеличивает-сложность-потому-что-ты-их-не-обрабатываешь" tabindex="-1"><strong>10.1 Почему Exception увеличивает сложность (Потому что ты их не обрабатываешь)</strong> <a class="header-anchor" href="#_10-1-почему-exception-увеличивает-сложность-потому-что-ты-их-не-обрабатываешь" aria-label="Permalink to &quot;**10.1 Почему Exception увеличивает сложность (Потому что ты их не обрабатываешь)**&quot;">​</a></h2><p>Под &quot;исключением&quot; я понимаю любую херню, которая прерывает нормальный поток выполнения программы. Это может быть <code>throw</code> в языке, а может быть спец-значение (типа вернуть <code>-1</code>, когда ждали позитив). И то, и другое — боль.</p><p>Откуда прилетает этот нежданчик:</p><ul><li>Вызывающий код передал кривые аргументы (руки из жопы).</li><li>Метод не смог сделать работу (I/O сдох, ресурса нет).</li><li>В распределенной системе пакеты потерялись или сервер ушел в запой.</li><li>Код нашел баг или несогласованность внутри себя.</li></ul><p>Код обработки ошибок писать сложнее, чем обычный. Исключение ломает флоу. У тебя два пути, и оба хреновые:</p><ol><li><strong>Попытаться починить и продолжить.</strong> (Типа переслать пакет). Но это может привести к дублям или бесконечным циклам ада.</li><li><strong>Бросить всё и умереть (abort).</strong> Но тогда надо откатывать состояние системы, иначе оставишь после себя битые структуры данных.</li></ol><p>Более того, код обработки ошибок часто <strong>сам генерирует новые ошибки</strong>. Пытался восстановить данные из бэкапа? А бэкап тоже битый. Поздравляю, ты в рекурсивной жопе.</p><p>Языковая поддержка исключений (особенно в Java) — это отдельный вид пытки. Взгляните на этот кусок кода для чтения твитов:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Три строчки полезного кода</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (FileNotFoundException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { ... }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ClassNotFoundException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { ... }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IOException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { ... }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ClassCastException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { ... }</span></span></code></pre></div><p>Бойлерплейта больше, чем логики. Читать это невозможно.</p><p>А самое веселое: <strong>код обработки ошибок почти невозможно протестировать</strong>. Эти ситуации на проде случаются раз в год, поэтому код хендлеров никогда не исполняется. А как гласит народная мудрость: &quot;Код, который не запускался — не работает&quot;. 90% катастрофических падений распределенных систем случаются из-за кривой обработки ошибок.</p><h2 id="_10-2-слишком-дохера-исключении" tabindex="-1"><strong>10.2 Слишком дохера исключений</strong> <a class="header-anchor" href="#_10-2-слишком-дохера-исключении" aria-label="Permalink to &quot;**10.2 Слишком дохера исключений**&quot;">​</a></h2><p>Программисты сами роют себе могилу, создавая лишние исключения. Нас учат: &quot;Отлавливай ошибки! Будь бдителен!&quot;. И начинается защитное программирование головного мозга: чуть что не так — кидаем эксепшн.</p><p>Я сам так обосрался, когда делал язык <strong>Tcl</strong>. Команда <code>unset</code> (удалить переменную) кидала ошибку, если переменной не существовало. Я думал: &quot;Ну это же баг, если удаляют то, чего нет!&quot;. А на практике <code>unset</code> часто используют для очистки мусора. И программистам приходилось оборачивать удаление в <code>catch</code>, чтобы скрипт не падал. Это была одна из моих самых тупых ошибок в дизайне.</p><p>Исключение — это часть интерфейса. Класс, который плюется ошибками на каждый чих — сложный и ненадежный.</p><h2 id="_10-3-спроектируи-так-чтобы-ошибки-не-возникали" tabindex="-1"><strong>10.3 Спроектируй так, чтобы ошибки не возникали</strong> <a class="header-anchor" href="#_10-3-спроектируи-так-чтобы-ошибки-не-возникали" aria-label="Permalink to &quot;**10.3 Спроектируй так, чтобы ошибки не возникали**&quot;">​</a></h2><p>Лучший способ не обрабатывать исключения — сделать так, чтобы их не было. Вернемся к моему факапу с <code>unset</code>. Надо было просто изменить определение: <code>unset</code> не &quot;удаляет переменную&quot;, а &quot;обеспечивает, чтобы переменной не было&quot;. Если переменной и так нет — задача выполнена. Успех. Ошибки не существует. Профит.</p><h2 id="_10-4-пример-удаление-фаила-в-windows-ад-vs-unix-раи" tabindex="-1"><strong>10.4 Пример: Удаление файла в Windows (Ад) vs Unix (Рай)</strong> <a class="header-anchor" href="#_10-4-пример-удаление-фаила-в-windows-ад-vs-unix-раи" aria-label="Permalink to &quot;**10.4 Пример: Удаление файла в Windows (Ад) vs Unix (Рай)**&quot;">​</a></h2><p><strong>Windows:</strong> Если файл открыт процессом, хер ты его удалишь. Это бесконечный источник боли. Юзеру надо искать, какой процесс держит файл, убивать его, или ребутать комп. <strong>Unix:</strong> Если файл открыт, Unix помечает его &quot;на удаление&quot; и возвращает успех. Имя файла исчезает из папки (новые процессы его не найдут), но старые процессы спокойно дочитывают данные. Когда все закроют файл — он исчезнет физически.</p><p>Unix просто взял и определил две ошибки как &quot;не ошибки&quot;:</p><ol><li>Удаление занятого файла — теперь ОК.</li><li>Чтение удаленного файла текущими процессами — теперь ОК.</li></ol><p>В итоге: меньше геморроя, меньше кода, все счастливы.</p><h2 id="_10-5-пример-java-substring-как-выстрелить-себе-в-ногу" tabindex="-1"><strong>10.5 Пример: Java substring (Как выстрелить себе в ногу)</strong> <a class="header-anchor" href="#_10-5-пример-java-substring-как-выстрелить-себе-в-ногу" aria-label="Permalink to &quot;**10.5 Пример: Java substring (Как выстрелить себе в ногу)**&quot;">​</a></h2><p>Метод <code>substring</code> в Java — это истеричка. Если ты попросишь подстроку, выходящую за границы, он кинет <code>IndexOutOfBoundsException</code>. Зачем? Мне часто нужно просто &quot;дай мне всё, что есть в этом диапазоне&quot;. Приходится писать 10 строк проверок индексов. Нормальный API (как срезы в Python) просто возвращает пересечение запрошенного диапазона и строки. Если индексы за пределами — верни пустую строку или то, что влезло. Ошибки нет, код чище.</p><p>Аргумент &quot;а вдруг это баг, надо сообщить!&quot; — слабый. Выкидывание исключений увеличивает сложность, а сложность порождает еще больше багов.</p><h2 id="_10-6-маскировка-исключении-типа-ничего-не-случилось" tabindex="-1"><strong>10.6 Маскировка исключений (Типа ничего не случилось)</strong> <a class="header-anchor" href="#_10-6-маскировка-исключении-типа-ничего-не-случилось" aria-label="Permalink to &quot;**10.6 Маскировка исключений (Типа ничего не случилось)**&quot;">​</a></h2><p>Второй метод: решай проблемы на низком уровне, чтобы &quot;начальство&quot; (верхний уровень кода) не знало.</p><ul><li><strong>TCP:</strong> Если пакет потерялся, протокол сам его перепошлет. Приложению вообще пофиг, оно думает, что сеть идеальна.</li><li><strong>NFS (Сетевая файловая система):</strong> Если сервер завис, клиент NFS просто... виснет. Он будет долбиться в сервер до посинения. Юзеры ноют, что приложение &quot;зависло&quot;. Но альтернатива — выкинуть ошибку. И что приложение будет с ней делать? Скорее всего, упадет. А так, сервер очнется, и всё продолжит работать, как ни в чем не бывало.</li></ul><p>Это пример &quot;спускания сложности вниз&quot;. Класс становится глубже, интерфейс проще.</p><h2 id="_10-7-агрегация-исключении" tabindex="-1"><strong>10.7 Агрегация исключений</strong> <a class="header-anchor" href="#_10-7-агрегация-исключении" aria-label="Permalink to &quot;**10.7 Агрегация исключений**&quot;">​</a></h2><p>Третий метод: обрабатывай кучу разных ошибок в одном месте.</p><p>Представьте веб-сервер. У него куча обработчиков URL. Каждый достает параметры. Если параметра нет — ошибка. <strong>Плохой путь:</strong> В каждом методе свой <code>try-catch</code>. Куча дубликатов.</p><p><img src="/a-philosophy-of-software-design/assets/00020.9j5ufL2N.jpeg" alt=""></p><p><em>Рис 10.1: Диспетчер вызывает обработчики URL. В каждом обработчике свой catch для каждого getParameter — код дублируется.</em></p><p><strong>Хороший путь:</strong> Пусть исключение летит на самый верх. Там, в главном цикле диспетчера, стоит один глобальный <code>try-catch</code>, который ловит всё и отдает клиенту красивый HTTP 400/500.</p><p><img src="/a-philosophy-of-software-design/assets/00021.CnXONOtr.jpeg" alt=""></p><p><em>Рис 10.2: Один глобальный обработчик в диспетчере ловит все исключения от всех методов.</em></p><p>Пример из <strong>RAMCloud</strong>: У них есть сложный механизм восстановления после падения сервера (восстанавливают данные с других нод). А что делать, если найден <em>один</em> битый объект? Они решили не писать отдельный код для восстановления одного объекта. Они просто <strong>крашат сервер</strong>, на котором нашли битый объект. Звучит дико? Да. Но это позволяет использовать <em>уже написанный и отлаженный</em> механизм восстановления сервера. Мы превращаем мелкую ошибку в крупную, чтобы обработать её общим механизмом.</p><h2 id="_10-8-а-может-просто-крашнуться-иногда-лучше-сдохнуть-сразу" tabindex="-1"><strong>10.8 А может, просто крашнуться? (Иногда лучше сдохнуть сразу)</strong> <a class="header-anchor" href="#_10-8-а-может-просто-крашнуться-иногда-лучше-сдохнуть-сразу" aria-label="Permalink to &quot;**10.8 А может, просто крашнуться? (Иногда лучше сдохнуть сразу)**&quot;">​</a></h2><p>Четвертый метод: <strong>Abort.</strong> Некоторые ошибки не стоит пытаться обрабатывать. Пример: <code>malloc</code> в C возвращает <code>NULL</code>, если память кончилась. Это заставляет проверять каждый чих. Если у тебя в 2024 году кончилась память — твоему приложению пизда. Не надо пытаться выжить, освобождая кэши. Скорее всего, это баг. Просто напиши обертку <code>ckalloc</code>, которая при неудаче пишет в лог &quot;Всё пропало&quot; и убивает процесс.</p><p>То же самое с &quot;невозможными&quot; состояниями (internal inconsistency). Если структура данных сломана — это баг. Не лови его, пусть падает. Это честнее и безопаснее, чем работать с битыми данными.</p><h2 id="_10-9-убираем-особые-случаи-special-cases" tabindex="-1"><strong>10.9 Убираем &quot;особые случаи&quot; (Special cases)</strong> <a class="header-anchor" href="#_10-9-убираем-особые-случаи-special-cases" aria-label="Permalink to &quot;**10.9 Убираем &quot;особые случаи&quot; (Special cases)**&quot;">​</a></h2><p>Спец-кейсы порождают <code>if</code>-ы. <code>If</code>-ы порождают баги. Пример: Текстовый редактор. Студенты часто делают переменную &quot;выделение&quot;, которая может быть <code>null</code>, если ничего не выделено. В итоге весь код засран проверками <code>if (selection != null)</code>. <strong>Решение:</strong> Выделение есть всегда. Просто иногда его длина = 0. Удалить пустое выделение? Легко, удаляем 0 байт. Копировать? Копируем 0 байт. Логика &quot;нет выделения&quot; нужна юзеру, а не коду. Внутри кода объект должен быть всегда.</p><h2 id="_10-10-taking-it-too-far" tabindex="-1"><strong>10.10 Taking it too far</strong> <a class="header-anchor" href="#_10-10-taking-it-too-far" aria-label="Permalink to &quot;**10.10 Taking it too far**&quot;">​</a></h2><p>Убирать ошибки — это круто, но не надо быть идиотом. Одни студенты в сетевом модуле глотали <em>все</em> ошибки. Сеть лежит? Похер, делаем вид, что отправили. В итоге приложение не знает, что данные не дошли. Это уже не упрощение, это саботаж. Важные ошибки (информация о которых нужна для принятия решений) скрывать нельзя.</p><h2 id="_10-11-итог" tabindex="-1"><strong>10.11 Итог</strong> <a class="header-anchor" href="#_10-11-итог" aria-label="Permalink to &quot;**10.11 Итог**&quot;">​</a></h2><p>Спец-кейсы и исключения — это рак кода.</p><ol><li>Переопредели семантику так, чтобы ошибок не существовало (пример с <code>unset</code> и удалением файлов).</li><li>Маскируй ошибки на нижнем уровне (как TCP).</li><li>Агрегируй обработку в одном месте.</li><li>Если всё плохо — падай.</li></ol><p>Чем меньше у тебя <code>catch</code> блоков, тем крепче твой сон.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/define-errors-out-of-existence.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2026-01-30T08:13:48.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/a-philosophy-of-software-design/better-together-or-better-apart.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>9. Вместе или порознь?</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/a-philosophy-of-software-design/design-it-twice.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>11. Проектируй дважды</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"better-together-or-better-apart.md\":\"DYbjDRBh\",\"choosing-names.md\":\"CsBL1mTU\",\"code-should-be-obvious.md\":\"De6eknsS\",\"comments-should-describe-things-that-are-not-obvious-from-the-code.md\":\"DjG8QTmH\",\"conclusion.md\":\"CHqwaTV3\",\"consistency.md\":\"9gJanjrc\",\"decide-what-matters.md\":\"DOGi44Zu\",\"define-errors-out-of-existence.md\":\"B-jsikCf\",\"design-it-twice.md\":\"BJ8g_YYs\",\"designing-for-performance.md\":\"CCwHz6MI\",\"different-layer-different-abstraction.md\":\"GtTuQ5uK\",\"general-purpose-modules-are-deeper.md\":\"DuaWooir\",\"index.md\":\"BZdtIbhH\",\"information-hiding-and-leakage.md\":\"hhpTWbPx\",\"introduction.md\":\"36gdDIvK\",\"modifying-existing-code.md\":\"C_IpLPy2\",\"modules-should-be-deep.md\":\"Bywxn7sq\",\"preface.md\":\"CY0NuYgN\",\"pull-complexity-downwards.md\":\"CRxFr1ht\",\"software-trends.md\":\"CYEonap6\",\"summary.md\":\"TH_qHPL4\",\"the-nature-of-complexity.md\":\"BqZew4UF\",\"why-write-comments-the-four-excuses.md\":\"IP1Sqd4a\",\"working-code-is-not-enough.md\":\"Dr2GhOCX\",\"write-the-comments-first.md\":\"DKpTOsya\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"ru-RU\",\"dir\":\"ltr\",\"title\":\"Философия дизайна ПО\",\"description\":\"A VitePress site\",\"base\":\"/a-philosophy-of-software-design/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"items\":[{\"text\":\"Предисловие\",\"link\":\"/preface\"},{\"text\":\"1. Введение\",\"link\":\"/introduction\"},{\"text\":\"2. Суть всей боли (Природа Сложности)\",\"link\":\"/the-nature-of-complexity\"},{\"text\":\"3. \\\"Работает — и ладно\\\" — девиз неудачников\",\"link\":\"/working-code-is-not-enough\"},{\"text\":\"4. Глубокие модули\",\"link\":\"/modules-should-be-deep\"},{\"text\":\"5. Прячем говно под ковер\",\"link\":\"/information-hiding-and-leakage\"},{\"text\":\"6. Универсальность модулей\",\"link\":\"/general-purpose-modules-are-deeper\"},{\"text\":\"7. Разные слои — разные абстракции\",\"link\":\"/different-layer-different-abstraction\"},{\"text\":\"8. Скидывай сложность вниз\",\"link\":\"/pull-complexity-downwards\"},{\"text\":\"9. Вместе или порознь?\",\"link\":\"/better-together-or-better-apart\"},{\"text\":\"10. Ошибок не существует\",\"link\":\"/define-errors-out-of-existence\"},{\"text\":\"11. Проектируй дважды\",\"link\":\"/design-it-twice\"},{\"text\":\"12. Зачем писать комменты?\",\"link\":\"/why-write-comments-the-four-excuses\"},{\"text\":\"13. Комментируй то, что не очевидно\",\"link\":\"/comments-should-describe-things-that-are-not-obvious-from-the-code\"},{\"text\":\"14. Нейминг\",\"link\":\"/choosing-names\"},{\"text\":\"15. Сначала комменты, потом код\",\"link\":\"/write-the-comments-first\"},{\"text\":\"16. Трогаем старый код\",\"link\":\"/modifying-existing-code\"},{\"text\":\"17. Консистентность\",\"link\":\"/consistency\"},{\"text\":\"18. Код должен быть понятен даже ежу\",\"link\":\"/code-should-be-obvious\"},{\"text\":\"19. Модные молодежные тренды\",\"link\":\"/software-trends\"},{\"text\":\"20. Производительность\",\"link\":\"/designing-for-performance\"},{\"text\":\"21. Определись, что важно\",\"link\":\"/decide-what-matters\"},{\"text\":\"22. Заключение\",\"link\":\"/conclusion\"},{\"text\":\"Шпаргалка\",\"link\":\"/summary\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Exoldy/a-philosophy-of-software-design/\"}],\"editLink\":{\"pattern\":\"https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>