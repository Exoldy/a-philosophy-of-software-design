# **15. Сначала комменты, потом код**

Многие разработчики откладывают написание документации на самый конец, когда код уже написан и юнит-тесты (если они вообще есть) пройдены. Это, блять, самый надежный способ произвести на свет документацию качества «полное говно». Лучшее время писать комментарии — это в самом начале, пока ты еще только пишешь код. Если писать комменты первыми, документация становится частью процесса проектирования. Это не только дает на выходе нормальное описание, но и спасает твой дизайн от убогости, да и сам процесс становится чуть менее мучительным.

## **15.1 "Напишу комменты потом" = "Не напишу никогда"**

Почти каждый разраб, которого я встречал, откладывает комменты на потом. Когда спрашиваешь этих гениев «почему бы не написать доку сразу?», они начинают ныть, что код, мол, еще меняется. Типа, если написать сейчас, потом придется переписывать; лучше подождать, пока код «стабилизируется». Но я подозреваю, что настоящая причина в другом: они считают документацию нудной ебаниной, поэтому оттягивают этот момент до последнего, как поход к стоматологу.

К сожалению, у такого подхода последствия печальные.
Во-первых, откладывание доки обычно приводит к тому, что она **не пишется вообще**. Стоит только начать откладывать, и остановиться невозможно; ведь через пару недель код станет «еще стабильнее», да? К тому моменту, когда код наконец-то устаканится, его становится так дохера, что задача по написанию комментов превращается в гигантскую кучу навоза, к которой страшно подступиться. У тебя никогда не найдется «пары свободных дней», чтобы просто сидеть и комментить. Всегда найдется оправдание, что важнее пофиксить баги или запилить новую фичу. Итог: горы недокументированного говнокода растут.

Даже если у тебя хватит самодисциплины вернуться и написать комменты (не льсти себе, скорее всего, не хватит), они будут отстойными. К этому моменту ты уже ментально «выписался» из этой задачи. В твоей голове этот кусок кода уже помечен как «Готово», и ты мысленно уже пилишь следующий таск. Ты знаешь, что писать комменты надо, но тебе пиздец как не хочется. Ты хочешь отделаться от этого как можно быстрее. В итоге ты пробегаешь по коду, накидывая пару строк чисто для вида, чтобы тимлид отъебался.
К тому же, с момента проектирования прошло время, и твои воспоминания о том, *почему* ты сделал именно так, уже затуманились. Ты смотришь на код и просто описываешь то, что видишь. Комменты начинают тупо дублировать код. Даже если попытаешься вспомнить неочевидные детали дизайна, что-то ты по-любому забудешь. В итоге в комментах не будет самого главного — сути.

## **15.2 Пиши комменты ДО кода**

Я использую другой подход: я пишу комменты в самом, сука, начале.

*   Для нового класса я сначала пишу **коммент к интерфейсу класса**.
*   Затем я пишу комменты и сигнатуры для самых важных публичных методов, но **тела методов оставляю пустыми**.
*   Я немного медитирую над этими комментами, пока структура не покажется мне правильной.
*   Дальше я пишу объявления и комменты для ключевых переменных инстанса.
*   И только потом я заполняю тела методов, добавляя комменты к реализации, если надо.
*   Пока пишу код, часто понимаю, что нужны еще методы или переменные. Для каждого нового метода я **сначала** пишу интерфейсный коммент, и только потом — код.

---

Когда код дописан, комменты тоже дописаны. Никакого бэклога из неписаной документации. Красота.

У подхода «комменты-сначала» есть три плюса.
Во-первых, комменты получаются лучше. Пока ты проектируешь класс, ключевые идеи свежи в твоей голове, и их легко записать. Лучше описать интерфейс метода до того, как ты начнешь говнокодить его тело, чтобы сосредоточиться на абстракции, а не отвлекаться на детали реализации. В процессе кодинга и тестов ты будешь замечать косяки в комментах и править их. В итоге, к релизу комменты станут только лучше.

## **15.3 Комментарии как инструмент дизайна (Думай, прежде чем кодить)**

Второй, и самый жирный плюс: это улучшает дизайн системы. Комменты — это единственный способ зафиксировать абстракции, а хорошие абстракции — это фундамент не-говенной системы. Если ты описываешь абстракции в начале, ты можешь перечитать их и потюнить *до того*, как наломаешь дров в коде. Чтобы написать хороший коммент, нужно понять суть переменной или куска кода: что в этой херне самое важное? Делать это надо на старте, иначе ты просто хаотично херачишь код (хакинг).

Комментарии работают как канарейка в шахте сложности. Если метод или переменная требуют комментария размером с «Войну и мир», это **красный флаг**: у тебя хуёвая абстракция. Вспоминаем Главу 4: классы должны быть глубокими (простой интерфейс, мощный функционал). Лучший способ оценить сложность интерфейса — посмотреть на его коммент.
Если коммент короткий, простой и полностью объясняет, как юзать метод — значит, интерфейс простой. Заебись.
Если же ты не можешь описать метод без длинного, запутанного эссе — значит, интерфейс переусложнен.
Сравни коммент интерфейса с реализацией: если коммент вынужден описывать все кишки реализации, значит, метод мелкий (shallow) и бесполезный. То же самое с переменными: если нужно полстраницы текста, чтобы объяснить, нахера эта переменная нужна — ты, скорее всего, облажался с декомпозицией.

Короче, написание комментов позволяет тебе оценить свои дизайнерские решения на раннем этапе и пофиксить их, пока не поздно.

> **КРАСНЫЙ ФЛАГ: Хрен опишешь**
>
> Комментарий, описывающий метод или переменную, должен быть простым и полным. Если тебе сложно родить такой коммент, это верный признак того, что дизайн этой штуки — говно.

Конечно, это работает, только если комменты честные. Если ты пишешь какую-то криптическую херню или упускаешь важные детали, то такой коммент ни хрена тебе не покажет.

## **15.4 Ранние комменты — это весело (Ну, почти)**

Третий плюс: писать комменты в начале тупо приятнее. Для меня самая кайфовая часть программирования — это ранняя стадия дизайна, когда я придумываю абстракции и структуру. Большую часть комментов я пишу именно тогда. Я ищу такой дизайн, который можно описать четко и в двух словах. Чем проще коммент — тем больше я горжусь своим дизайном.
Если ты программируешь стратегически (то есть твоя цель — крутой дизайн, а не просто «хуяк-хуяк и в продакшн»), то написание комментов должно приносить удовольствие, потому что именно так ты понимаешь, что сделал всё по красоте.

## **15.5 Дорого ли это? (Нет, переписывать говнокод дороже)**

Вернемся к аргументу ленивых задниц про то, что «писать сразу дорого, придется переписывать». Простая математика на салфетке показывает, что это экономия на спичках.
Прикинь, сколько времени ты реально тратишь на *набор текста* (кода и комментов)? Вряд ли больше 10% от всего времени разработки. Даже если половина твоих строк — это комменты (что вряд ли), то их написание занимает от силы 5% времени. Откладывая их на потом, ты сэкономишь крохи от этих 5%. Это ни о чем.

Зато если писать комменты сначала, твои абстракции станут стабильнее *до* того, как ты начнешь писать код. Это сэкономит тебе время на самом кодинге. А если начнешь сразу с кода, абстракции будут меняться на лету, и тебе придется переписывать *сам код* чаще, чем пришлось бы править комменты.
Если сложить все факторы, вполне вероятно, что писать комменты сразу — тупо быстрее.

## **15.6 Итог**

Если ты никогда не пробовал писать комменты сначала — попробуй, не будь занудой. Заставь себя делать так какое-то время, чтобы привыкнуть. А потом посмотри, как это повлияло на качество твоей писанины, на качество твоего кода и на то, насколько меньше тебе хочется выйти в окно в процессе разработки. Попробуй, а потом расскажешь, прав я был или нет.