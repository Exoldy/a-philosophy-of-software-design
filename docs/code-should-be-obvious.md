# **–ì–õ–ê–í–ê 18. –ö–û–î –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –û–ß–ï–í–ò–î–ù–´–ú**

### **(–ò–ª–∏ –ø–æ—á–µ–º—É —Ç–≤–æ–π ¬´–≥–µ–Ω–∏–∞–ª—å–Ω—ã–π¬ª –∫–æ–¥ ‚Äî –≥–æ–≤–Ω–æ, –µ—Å–ª–∏ –µ–≥–æ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å)**

¬´–ù–µ–ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å¬ª (Obscurity) ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –≤—Å–∞–¥–Ω–∏–∫–æ–≤ –ê–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ 2.3. –ù–µ–ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–∞ –æ —Å–∏—Å—Ç–µ–º–µ –Ω–∏—Ö—Ä–µ–Ω–∞ –Ω–µ –æ—á–µ–≤–∏–¥–Ω–∞ –Ω–æ–≤—ã–º —Ä–∞–∑—Ä–∞–±–∞–º. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≥–µ–Ω–∏–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ: –ø–∏—à–∏ –∫–æ–¥ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª, —Å—É–∫–∞, –æ—á–µ–≤–∏–¥–Ω—ã–º. –í —ç—Ç–æ–π –≥–ª–∞–≤–µ –º—ã –æ–±—Å–æ—Å–µ–º —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –∫–æ–¥ –ª–∏–±–æ –ø–æ–Ω—è—Ç–Ω—ã–º, –ª–∏–±–æ –∑–∞–≥–∞–¥–∫–æ–π –æ—Ç –ñ–∞–∫–∞ –§—Ä–µ—Å–∫–æ.

–ï—Å–ª–∏ –∫–æ–¥ –æ—á–µ–≤–∏–¥–µ–Ω, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ª—é–±–æ–π –º–∏–º–æ–∫—Ä–æ–∫–æ–¥–∏–ª –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–±–µ–∂–∞—Ç—å –µ–≥–æ –≥–ª–∞–∑–∞–º–∏, –æ—Å–æ–±–æ –Ω–µ –Ω–∞–ø—Ä—è–≥–∞—è –∏–∑–≤–∏–ª–∏–Ω—ã, –∏ –µ–≥–æ –ø–µ—Ä–≤–∞—è –¥–æ–≥–∞–¥–∫–∞ –æ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ—Ç –∫–æ–¥ –¥–µ–ª–∞–µ—Ç, –æ–∫–∞–∂–µ—Ç—Å—è –≤–µ—Ä–Ω–æ–π. –ï—Å–ª–∏ –∫–æ–¥ –æ—á–µ–≤–∏–¥–µ–Ω, —á–∏—Ç–∞—Ç–µ–ª—é –Ω–µ –Ω—É–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å —á–∞—Å—ã –∏ –Ω–µ—Ä–≤–Ω—ã–µ –∫–ª–µ—Ç–∫–∏, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –≤ –∫—É—á—É –≤—Å—é –∏–Ω—Ñ—É –¥–ª—è —Ä–∞–±–æ—Ç—ã. –ï—Å–ª–∏ –∂–µ –∫–æ–¥ **–Ω–µ** –æ—á–µ–≤–∏–¥–µ–Ω, —á–∏—Ç–∞—Ç–µ–ª—å —Ç—Ä–∞—Ç–∏—Ç —É–π–º—É –≤—Ä–µ–º–µ–Ω–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏, –ø—ã—Ç–∞—è—Å—å –≤—Ä—É–±–∏—Ç—å—Å—è –≤ —Ç–≤–æ–π –ø–æ–ª–µ—Ç –º—ã—Å–ª–∏. –≠—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–æ –∏ –ø–ª–æ–¥–∏—Ç –±–∞–≥–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–π–º–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –û—á–µ–≤–∏–¥–Ω–æ–º—É –∫–æ–¥—É –Ω—É–∂–Ω–æ –º–µ–Ω—å—à–µ –∫–æ–º–º–µ–Ω—Ç–æ–≤, —á–µ–º —Ç–≤–æ–µ–º—É –º–∞–∫–∞—Ä–æ–Ω–Ω–æ–º—É –º–æ–Ω—Å—Ç—Ä—É.

¬´–û—á–µ–≤–∏–¥–Ω–æ—Å—Ç—å¬ª ‚Äî –ø–æ–Ω—è—Ç–∏–µ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ, –æ–Ω–æ –≤ –≥–æ–ª–æ–≤–µ —É —á–∏—Ç–∞—Ç–µ–ª—è. –ó–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ —á—É–∂–æ–π –∫–æ–¥ ‚Äî –º—É—Ç–Ω–∞—è —Ö–µ—Ä–Ω—è, –≥–æ—Ä–∞–∑–¥–æ –ø—Ä–æ—â–µ, —á–µ–º –ø—Ä–∏–∑–Ω–∞—Ç—å —ç—Ç–æ –≤ —Å–≤–æ–µ–º. –ü–æ—ç—Ç–æ–º—É –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –Ω–∞ –≤—à–∏–≤–æ—Å—Ç—å ‚Äî —ç—Ç–æ –∫–æ–¥-—Ä–µ–≤—å—é. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –Ω–∞ —Ä–µ–≤—å—é –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ —Ç–≤–æ–π –∫–æ–¥ –Ω–µ–æ—á–µ–≤–∏–¥–µ–Ω ‚Äî –∑–Ω–∞—á–∏—Ç, –æ–Ω, –±–ª—è—Ç—å, –Ω–µ–æ—á–µ–≤–∏–¥–µ–Ω, –∏ –ø–ª–µ–≤–∞—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –æ–Ω –∫–∞–∂–µ—Ç—Å—è —Ç–µ–±–µ. –ü–æ–ø—ã—Ç–∞–π—Å—è –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–≤–µ–ª–æ –∫–æ–ª–ª–µ–≥—É –≤ —Å—Ç—É–ø–æ—Ä, –∏ –≤ –±—É–¥—É—â–µ–º —Ç—ã, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—à—å –ø–∏—Å–∞—Ç—å –∫–∞–∫ –º—É–¥–∞–∫.

## **18.1 –í–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –∫–æ–¥ –ø–æ–Ω—è—Ç–Ω–µ–µ**

–î–≤–∞ –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–∏–µ–º–∞ –º—ã —É–∂–µ –æ–±–º—É—Å–æ–ª–∏–ª–∏ –≤ –ø—Ä–æ—à–ª—ã—Ö –≥–ª–∞–≤–∞—Ö, –Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ‚Äî –º–∞—Ç—å —É—á–µ–Ω–∏—è.
1.  **–í—ã–±–æ—Ä –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω** (–ì–ª–∞–≤–∞ 14). –¢–æ—á–Ω—ã–µ –∏ —Å–º—ã—Å–ª–æ–≤—ã–µ –∏–º–µ–Ω–∞ –æ–±—ä—è—Å–Ω—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–¥–∞ –ª—É—á—à–µ –ª—é–±–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –ï—Å–ª–∏ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ç—É–º–∞–Ω–Ω–æ–µ –∏–ª–∏ –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ–µ, —á–∏—Ç–∞—Ç–µ–ª—é –ø—Ä–∏–¥–µ—Ç—Å—è –ø–µ—Ä–µ—Ä—ã—Ç—å –≤–µ—Å—å –∫–æ–¥, —á—Ç–æ–±—ã –¥–µ–¥—É–∫—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –≤—ã—á–∏—Å–ª–∏—Ç—å, —á—Ç–æ —ç—Ç–æ –∑–∞ —Å—É—â–Ω–æ—Å—Ç—å. –≠—Ç–æ –¥–æ–ª–≥–æ –∏ —á—Ä–µ–≤–∞—Ç–æ —Ñ–∞–∫–∞–ø–∞–º–∏.
2.  **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** (–ì–ª–∞–≤–∞ 17). –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–∏–µ –≤–µ—â–∏ –¥–µ–ª–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ, —á–∏—Ç–∞—Ç–µ–ª—å —É–∑–Ω–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏ —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ—Ç (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ) –≤—ã–≤–æ–¥—ã, –Ω–µ –≤—á–∏—Ç—ã–≤–∞—è—Å—å –≤ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ—á–∫—É.

–ê –≤–æ—Ç —Ç–µ–±–µ –µ—â–µ –ø–∞—á–∫–∞ —Ç–µ—Ö–Ω–∏–∫, —á—Ç–æ–±—ã —Ç–≤–æ–π –∫–æ–¥ –Ω–µ –≤—ã–≥–ª—è–¥–µ–ª –∫–∞–∫ —à–∏—Ñ—Ä–æ–≤–∫–∞:

### **–ì—Ä–∞–º–æ—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ –º–µ—Å—Ç–∞ (Whitespace)**

–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ, –≤—ã—Ç–µ–∫—É—Ç —É —á–∏—Ç–∞—Ç–µ–ª—è –≥–ª–∞–∑–∞ –∏–ª–∏ –Ω–µ—Ç. –í–∑–≥–ª—è–Ω–∏ –Ω–∞ —ç—Ç—É –¥–æ–∫—É –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –≤—ã–¥–∞–≤–∏–ª–∏ –≤–µ—Å—å –≤–æ–∑–¥—É—Ö, –∫–∞–∫ –∏–∑ –≤–∞–∫—É—É–º–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏:

```java
/**
 *  ...
 *  @param numThreads The number of threads that this manager should
 *  spin up in order to manage ongoing connections. The MessageManager
 *  spins up at least one thread for every open connection, so this
 *  should be at least equal to the number of connections you expect
 *  to be open at once. This should be a multiple of that number if
 *  you expect to send a lot of messages in a short amount of time.
 *  @param handler Used as a callback in order to handle incoming
 *  messages on this MessageManager's open connections. See
 *  {@code MessageHandler} and {@code handleMessage} for details.
 */
```

–•—Ä–µ–Ω –ø–æ–π–º–µ—à—å, –≥–¥–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥—Ä—É–≥–æ–µ. –î–∞–∂–µ –∏–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ª–∏–≤–∞—é—Ç—Å—è –≤ –∫–∞—à—É. –ù–æ —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–±–µ–ª–æ–≤, –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π, –∫–∞–∫ —Å–ª–µ–∑–∞ –º–ª–∞–¥–µ–Ω—Ü–∞:

```java
/**
 *  @param numThreads
 *           The number of threads that this manager should spin up in
 *           order to manage ongoing connections. The MessageManager spins
 *           up at least one thread for every open connection, so this
 *           should be at least equal to the number of connections you
 *           expect to be open at once. This should be a multiple of that
 *           number if you expect to send a lot of messages in a short
 *           amount of time.
 *  @param handler
 *           Used as a callback in order to handle incoming messages on
 *           this MessageManager's open connections. See
 *           {@code MessageHandler} and {@code handleMessage} for details.
 */
```

–ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–∫–∂–µ –ø–æ–ª–µ–∑–Ω—ã, —á—Ç–æ–±—ã —Ä–∞–∑–±–∏–≤–∞—Ç—å –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏, –∫–∞–∫ –∑–¥–µ—Å—å:

```cpp
void* Buffer::allocAux(size_t numBytes) {
    //  –û–∫—Ä—É–≥–ª—è–µ–º –¥–ª–∏–Ω—É –¥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ 8 –±–∞–π—Ç–∞–º –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è.
    uint32_t numBytes32 =  (downCast<uint32_t>(numBytes) + 7) & ~0x7;
    assert(numBytes32 != 0);

    //  –ï—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ –≤ firstAvailable, —é–∑–∞–µ–º –µ–≥–æ. –ò–¥–µ–º —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑,
    //  –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–∞ –ø–∞–º—è—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω–∞.
    if  (availableLength >= numBytes32) {
        availableLength -= numBytes32;
        return firstAvailable + availableLength;
    }

    //  –î–∞–ª–µ–µ, —Å–º–æ—Ç—Ä–∏–º, –µ—Å—Ç—å –ª–∏ –º–µ—Å—Ç–æ –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞–Ω–∫–∞.
    if  (extraAppendBytes >= numBytes32) {
        extraAppendBytes -= numBytes32;
        return lastChunk->data + lastChunk->length + extraAppendBytes;
    }

    //  –ù—É –≤—Å—ë, –ø–∏–∑–¥–µ—Ü, –Ω–∞–¥–æ –≤—ã–¥–µ–ª—è—Ç—å –Ω–æ–≤—É—é –ø–∞–º—è—Ç—å.
    uint32_t allocatedLength;
    firstAvailable = getNewAllocation(numBytes32, &allocatedLength);
    availableLength = allocatedLength numBytes32;
    return firstAvailable + availableLength;
}
```

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ –∑–∞–µ–±–∏—Å—å, –µ—Å–ª–∏ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –ø—É—Å—Ç–æ–≥–æ –º–µ—Å—Ç–∞ ‚Äî —ç—Ç–æ –∫–æ–º–º–µ–Ω—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫. –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–µ–ª–∞—é—Ç –∫–æ–º–º–µ–Ω—Ç—ã –∑–∞–º–µ—Ç–Ω–µ–µ.

–ü—Ä–æ–±–µ–ª—ã –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ —Ç–æ–∂–µ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –≤–æ–æ–±—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. –°—Ä–∞–≤–Ω–∏ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–∫–æ–¥ –∫—É—Ä–∏–ª—å—â–∏–∫–∞ vs –∫–æ–¥ –∑–¥–æ—Ä–æ–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞):

```java
for(int pass=1;pass>=0&&!empty;pass--) { // –£–∂–∞—Å —ç–ø–∏–ª–µ–ø—Ç–∏–∫–∞

for (int pass = 1; pass >= 0 && !empty; pass--) { // –ù–æ—Ä–º–∞–ª—å–Ω–æ –∂–µ –æ–±—â–∞–ª–∏—Å—å
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.** –ò–Ω–æ–≥–¥–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –æ—á–µ–≤–∏–¥–Ω—ã–π –∫–æ–¥ —Ç—É–ø–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –ë—ã–≤–∞–µ—Ç. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö —é–∑–∞–π –∫–æ–º–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—é –±–µ—Å–ø–æ–º–æ—â–Ω–æ—Å—Ç—å –∏ –¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –∏–Ω—Ñ—É. –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ—Å—Ç–∞–≤—å —Å–µ–±—è –Ω–∞ –º–µ—Å—Ç–æ —á–∏—Ç–∞—Ç–µ–ª—è: –ø–æ–¥—É–º–∞–π, –≥–¥–µ –æ–Ω –∑–∞—Ç—É–ø–∏—Ç, –∏ –æ–±—ä—è—Å–Ω–∏ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ.

## **18.2 –í–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –∫–æ–¥ –º—É—Ç–Ω—ã–º –≥–æ–≤–Ω–æ–º**

–°–ø–æ—Å–æ–±–æ–≤ –∑–∞–ø—É—Ç–∞—Ç—å –∫–æ–¥ ‚Äî –º–∏–ª–ª–∏–æ–Ω. –í–æ—Ç –ª–∏—à—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –Ω–∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–±—ã—Ç–∏–π–∫–∞) –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω—ã, –Ω–æ —Ç–æ–≥–¥–∞ –±—É–¥—å –¥–æ–±—Ä –æ–±–º–∞–∑–∞—Ç—å—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å.

**Event-driven programming (–°–æ–±—ã—Ç–∏–π–∫–∞).** –í —ç—Ç–æ–π –ø–∞—Ä–∞–¥–∏–≥–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω—é—é —Ö–µ—Ä–Ω—é: –ø—Ä–∏–ª–µ—Ç–µ–ª –ø–∞–∫–µ—Ç, —é–∑–µ—Ä —Ç–∫–Ω—É–ª –º—ã—à–∫–æ–π –∏ —Ç.–¥. –û–¥–∏–Ω –º–æ–¥—É–ª—å –æ—Ä–µ—Ç, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Å–ª—É—á–∏–ª–æ—Å—å, –¥—Ä—É–≥–∏–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏ –ø—Ä–æ—Å—è—Ç –¥–µ—Ä–Ω—É—Ç—å –∏—Ö –º–µ—Ç–æ–¥—ã.

–°–æ–±—ã—Ç–∏–π–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (flow of control) –≤ –∞–¥—Å–∫–∏–π –∫–≤–µ—Å—Ç. –§—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é; –∏—Ö –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–π–Ω—ã–π –¥–≤–∏–∂–æ–∫, –æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã. –î–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –Ω–∞–π–¥–µ—à—å –º–µ—Å—Ç–æ –≤—ã–∑–æ–≤–∞ –≤ –¥–≤–∏–∂–∫–µ, —Ç—ã —Ö–µ—Ä —É–≥–∞–¥–∞–µ—à—å, –∫–∞–∫–∞—è –∏–º–µ–Ω–Ω–æ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî —ç—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ —Ç–∞–º –Ω–∞—Ä–µ–≥–∞–ª–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å –æ —Ç–∞–∫–æ–º –∫–æ–¥–µ –∏ –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º, —á—Ç–æ –æ–Ω –≤–æ–æ–±—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –∑–∞–¥–∞—á–∞ –Ω–µ –¥–ª—è —Å–ª–∞–±–æ–Ω–µ—Ä–≤–Ω—ã—Ö.

–ß—Ç–æ–±—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –º—É—Ç—å, –ø–∏—à–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ö –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞, –∫–æ–≥–¥–∞ –∏ –∫—Ç–æ –µ–≥–æ, —Å—É–∫–∞, –≤—ã–∑—ã–≤–∞–µ—Ç:

```java
/**
 * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø–æ—Ç–æ–∫–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º, –µ—Å–ª–∏
 * –æ—à–∏–±–∫–∞ —É—Ä–æ–≤–Ω—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –Ω–µ –¥–∞–µ—Ç RPC –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è.
 */
void Transport::RpcNotifier::failed() {
    ...
}
```

> **üö© –ö–†–ê–°–ù–´–ô –§–õ–ê–ì: –ù–µ–æ—á–µ–≤–∏–¥–Ω—ã–π –∫–æ–¥**
>
> –ï—Å–ª–∏ —Å–º—ã—Å–ª –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–µ–ª—å–∑—è –ø–æ–Ω—è—Ç—å –±—ã—Å—Ç—Ä—ã–º –≤–∑–≥–ª—è–¥–æ–º ‚Äî —ç—Ç–æ –∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥. –û–±—ã—á–Ω–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –µ—Å—Ç—å –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–∫—Ä—ã—Ç–∞ –æ—Ç –≥–ª–∞–∑ —á–∏—Ç–∞—Ç–µ–ª—è.

**–î–∂–µ–Ω–µ—Ä–∏–∫–∏-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (Generic containers).** –ú–Ω–æ–≥–∏–µ —è–∑—ã–∫–∏ –¥–∞—é—Ç –Ω–∞–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã, —á—Ç–æ–±—ã —Å–≤–∞–ª–∏—Ç—å –¥–≤–∞ –∏ –±–æ–ª–µ–µ –∫—É—Å–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω—É –∫—É—á—É, —Ç–∏–ø–∞ `Pair` –≤ Java –∏–ª–∏ `std::pair` –≤ C++. –°–æ–±–ª–∞–∑–Ω –≤–µ–ª–∏–∫: –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—á–∫—É –æ–±—ä–µ–∫—Ç–æ–≤ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å. –ß–∞—Å—Ç–æ —Ç–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –º–µ—Ç–æ–¥–∞:

```java
return new Pair<Integer, Boolean>(currentTerm, false);
```

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Ç–∞–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–µ–ª–∞—é—Ç –∫–æ–¥ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–º, –ø–æ—Ç–æ–º—É —á—Ç–æ —É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ–±—â–∏–µ, –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—á–∞—â–∏–µ –∏–º–µ–Ω–∞. –í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ –±—É–¥–µ—Ç –¥–µ—Ä–≥–∞—Ç—å `result.getKey()` –∏ `result.getValue()`. –ß—Ç–æ —Ç–∞–∫–æ–µ `Key`? –ß—Ç–æ —Ç–∞–∫–æ–µ `Value`? –•—É–π –ø—Ä–æ—Å—Å—ã—à—å.

–ö–æ—Ä–æ—á–µ, –Ω–µ —é–∑–∞–π –¥–∂–µ–Ω–µ—Ä–∏–∫-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–µ –ª–µ–Ω–∏—Å—å, —Å–æ–∑–¥–∞–π –ø–æ–¥ —ç—Ç–æ –¥–µ–ª–æ –º–∞–ª–µ–Ω—å–∫–∏–π –∫–ª–∞—Å—Å –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –¢–∞–º —Ç—ã —Å–º–æ–∂–µ—à—å –¥–∞—Ç—å –ø–æ–ª—è–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞, –∏, –æ —á—É–¥–æ, –∫–æ–¥ —Å—Ç–∞–Ω–µ—Ç —á–∏—Ç–∞–µ–º—ã–º.

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ: **—Å–æ—Ñ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –µ–≥–æ –±—ã–ª–æ –ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å, –∞ –Ω–µ –ª–µ–≥–∫–æ –ø–∏—Å–∞—Ç—å.** –î–∂–µ–Ω–µ—Ä–∏–∫–∏ —É–¥–æ–±–Ω—ã –¥–ª—è –ø–∏—Å–∞—Ç–µ–ª—è (—Å—ç–∫–æ–Ω–æ–º–∏–ª 2 –º–∏–Ω—É—Ç—ã), –Ω–æ —Å–æ–∑–¥–∞—é—Ç –≥–µ–º–æ—Ä—Ä–æ–π –¥–ª—è –≤—Å–µ—Ö —á–∏—Ç–∞—Ç–µ–ª–µ–π –≤ –±—É–¥—É—â–µ–º. –õ—É—á—à–µ –ø–æ—Ç—Ä–∞—Ç—å –ø–∞—Ä—É –º–∏–Ω—É—Ç —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º —Ç–µ–±—è –Ω–µ –ø–æ–º–∏–Ω–∞–ª–∏ –ª–∏—Ö–æ–º.

**–†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –∏ –∞–ª–ª–æ–∫–∞—Ü–∏–∏.** –ó–∞—Ü–µ–Ω–∏ Java-–∫–æ–¥:

```java
private List<Message> incomingMessageList;
...
incomingMessageList = new ArrayList<Message>();
```

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±—ä—è–≤–ª–µ–Ω–∞ –∫–∞–∫ `List`, –Ω–æ –ø–æ —Ñ–∞–∫—Ç—É —Ç–∞–º `ArrayList`. –≠—Ç–æ –ª–µ–≥–∞–ª—å–Ω–æ (–ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º, –≤—Å–µ –¥–µ–ª–∞), –Ω–æ –º–æ–∂–µ—Ç —Å–±–∏—Ç—å —Å —Ç–æ–ª–∫—É —á–∏—Ç–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ. –†–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—É `ArrayList` —Å–≤–æ—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–∫–æ–ª—ã —Å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é), —Ç–∞–∫ —á—Ç–æ –ª—É—á—à–µ –Ω–µ –ø—É—Ç–∞—Ç—å —Å–ª–µ–¥—ã –∏ –º–∞—Ç—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å –∞–ª–ª–æ–∫–∞—Ü–∏–µ–π.

**–ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ä—É—à–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è.** –ü—Ä–µ–¥—Å—Ç–∞–≤—å `main` —Ñ—É–Ω–∫—Ü–∏—é Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```java
public static void main(String[] args) {
    ...
    new RaftClient(myAddress, serverAddresses);
}
```

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è, –∫–æ–≥–¥–∞ `main` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è. –ß–∏—Ç–∞—Ç–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ. –ù–æ —Ç—É—Ç ‚Äî —Å—é—Ä–ø—Ä–∏–∑, –º–∞–∑–∞—Ñ–∞–∫–∞! –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `RaftClient` —Å–æ–∑–¥–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –º–æ–ª–æ—Ç–∏—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ `main`. –¢–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –≤ `RaftClient`, –Ω–æ –æ–Ω–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç –∏ –≤ –∫–æ–Ω–µ—Ü `main`. –ù–∞–ø–∏—à–∏ –ø—Ä—è–º—ã–º —Ç–µ–∫—Å—Ç–æ–º: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å–¥–æ—Ö–Ω–µ—Ç, –æ–Ω–æ –±—É–¥–µ—Ç –∂–∏—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö". –ö–æ–¥ –æ—á–µ–≤–∏–¥–µ–Ω —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–∏—à–∏ –æ–±—ä—è—Å–Ω–∏—Ç–µ–ª—å–Ω—É—é.

## **18.3 –ò—Ç–æ–≥–∏**

–î—É–º–∞–π –æ–± –æ—á–µ–≤–∏–¥–Ω–æ—Å—Ç–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö **–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**. –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ–æ—á–µ–≤–∏–¥–µ–Ω, –∑–Ω–∞—á–∏—Ç, —á–∏—Ç–∞—Ç–µ–ª—é –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∞–∫–æ–π-—Ç–æ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ—ã: –≤ –ø—Ä–∏–º–µ—Ä–µ —Å `RaftClient` –æ–Ω –Ω–µ –∑–Ω–∞–ª –ø—Ä–æ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ—Ç–æ–∫–∏; –≤ –ø—Ä–∏–º–µ—Ä–µ —Å `Pair` –æ–Ω –Ω–µ –∑–Ω–∞–ª, —á—Ç–æ `getKey()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Ä–º–∞.

–ß—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª –æ—á–µ–≤–∏–¥–Ω—ã–º, —É–±–µ–¥–∏—Å—å, —á—Ç–æ —É —á–∏—Ç–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è.
1.  **–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–±:** –£–º–µ–Ω—å—à–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ—ã (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü-–∫–µ–π—Å–æ–≤). –ß–µ–º –º–µ–Ω—å—à–µ –Ω–∞–¥–æ –∑–Ω–∞—Ç—å, —Ç–µ–º –ø—Ä–æ—â–µ –∂–∏—Ç—å.
2.  **–í—Ç–æ—Ä–æ–π —Å–ø–æ—Å–æ–±:** –ò—Å–ø–æ–ª—å–∑—É–π –∑–Ω–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É —á–∏—Ç–∞—Ç–µ–ª—è —É–∂–µ –µ—Å—Ç—å (—Å–ª–µ–¥—É–π –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º, –Ω–µ –∏–∑–æ–±—Ä–µ—Ç–∞–π –≤–µ–ª–æ—Å–∏–ø–µ–¥), —á—Ç–æ–±—ã –µ–º—É –Ω–µ –ø—Ä–∏—à–ª–æ—Å—å —É—á–∏—Ç—å –Ω–æ–≤—É—é —Ö–µ—Ä–Ω—é —Ä–∞–¥–∏ —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞.
3.  **–¢—Ä–µ—Ç–∏–π —Å–ø–æ—Å–æ–±:** –ï—Å–ª–∏ —É–∂ –∏–Ω—Ñ–∞ –Ω—É–∂–Ω–∞, –ø—Ä–µ–ø–æ–¥–Ω–µ—Å–∏ –µ—ë –Ω–∞ –±–ª—é–¥–µ—á–∫–µ –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ ‚Äî —á–µ—Ä–µ–∑ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç—ã.