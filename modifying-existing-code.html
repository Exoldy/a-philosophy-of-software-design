<!DOCTYPE html>
<html lang="ru-RU" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>16. Трогаем старый код (Некромантия и Рефакторинг) | Философия дизайна ПО</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/assets/style.CSPm08Rv.css" as="style">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/vp-icons.css" as="style">
    
    <script type="module" src="/a-philosophy-of-software-design/assets/app.DVEU4zNL.js"></script>
    <link rel="preload" href="/a-philosophy-of-software-design/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/theme.DDW5w42F.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/framework.CM3gOIkZ.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/modifying-existing-code.md.DmSkHgx5.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/a-philosophy-of-software-design/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Философия дизайна ПО</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/preface.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Предисловие</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/introduction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>1. Введение</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/the-nature-of-complexity.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>2. Суть всей боли (Природа Сложности)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/working-code-is-not-enough.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>3. "Работает — и ладно" — девиз неудачников</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>4. Глубокие модули</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/information-hiding-and-leakage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>5. Прячем говно под ковер</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6. Универсальность модулей</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/different-layer-different-abstraction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>7. Разные слои — разные абстракции</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/pull-complexity-downwards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>8. Скидывай сложность вниз</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/better-together-or-better-apart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>9. Вместе или порознь?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/define-errors-out-of-existence.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10. Ошибок не существует</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/design-it-twice.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11. Проектируй дважды</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/why-write-comments-the-four-excuses.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12. Зачем писать комменты?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/comments-should-describe-things-that-are-not-obvious-from-the-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13. Комментируй то, что не очевидно</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/choosing-names.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14. Нейминг</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15. Сначала комменты, потом код</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modifying-existing-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16. Трогаем старый код</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/consistency.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17. Консистентность</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/code-should-be-obvious.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18. Код должен быть понятен даже ежу</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/software-trends.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19. Модные молодежные тренды</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/designing-for-performance.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20. Производительность</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/decide-what-matters.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21. Определись, что важно</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/conclusion.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22. Заключение</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/summary.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Шпаргалка</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _a-philosophy-of-software-design_modifying-existing-code" data-v-39a288b8><div><h1 id="_16-трогаем-старыи-код-некромантия-и-рефакторинг" tabindex="-1"><strong>16. Трогаем старый код (Некромантия и Рефакторинг)</strong> <a class="header-anchor" href="#_16-трогаем-старыи-код-некромантия-и-рефакторинг" aria-label="Permalink to &quot;**16. Трогаем старый код (Некромантия и Рефакторинг)**&quot;">​</a></h1><p>Как тебе уже пояснили в первой главе, разработка софта — это, сука, итеративный процесс. Крупная система растет через стадии эволюции, как покемон, только вместо новых абилок она обрастает легаси и костылями. Дизайн системы вечно мутирует.</p><p>Сразу придумать идеальную архитектуру <strong>невозможно</strong>, даже не пытайся. Дизайн зрелой системы определяется не тем, что ты там нафантазировал на старте, а тем, как её насиловали правками в процессе жизни. В прошлых главах мы говорили, как не наговнокодить с нуля; в этой поговорим, как не дать энтропии и пиздецу поглотить проект, когда он уже запущен.</p><h2 id="_16-1-оставаися-стратегом-не-скатываися-в-лишь-бы-заработало" tabindex="-1"><strong>16.1 Оставайся стратегом (Не скатывайся в &quot;лишь бы заработало&quot;)</strong> <a class="header-anchor" href="#_16-1-оставаися-стратегом-не-скатываися-в-лишь-бы-заработало" aria-label="Permalink to &quot;**16.1 Оставайся стратегом (Не скатывайся в &quot;лишь бы заработало&quot;)**&quot;">​</a></h2><p>В 3-й главе мы уже перетирали за разницу между тактическим («хуяк-хуяк и в продакшн») и стратегическим программированием.</p><ul><li><strong>Тактика:</strong> Главное, чтобы работало <em>сейчас</em>. Даже если код выглядит как блевотина.</li><li><strong>Стратегия:</strong> Главное — крутой дизайн системы.</li></ul><p>Тактический подход мгновенно превращает проект в помойку. Если ты хочешь систему, которую можно поддерживать, критерий «оно работает» — это для лохов. Ты должен думать о дизайне, даже когда просто ковыряешь старый код.</p><p>Но реальность сурова. Когда разрабы лезут чинить баги или пилить фичи в старом коде, у них отключается мозг и включается режим ссыкла. Типичная мысль: <em>«Какое минимальное изменение я могу сделать, чтобы ничего не сломать и свалить домой?»</em>. Они боятся кода. Они думают, что серьезный рефакторинг принесет новые баги. Но этот страх порождает <strong>тактическое говнокодерство</strong>. Каждая такая «минимальная правка» добавляет новый if-чик, лишнюю зависимость или спец-кейс. В итоге система гниет с каждым коммитом.</p><p>Хочешь чистый код? Будь мужиком, включай стратегическое мышление. После твоей правки код должен выглядеть так, как будто эта фича была там задумана изначально архитекторами из NASA. Видишь искушение сделать быстрый фикс? Бей себя по рукам. Подумай: подходит ли текущий дизайн под новую задачу? Если нет — <strong>рефактори, сука</strong>. Только так дизайн становится лучше, а не скатывается в сраное болото.</p><p>Это та самая «инвестиция», о которой говорили на 15-й странице. Потратишь лишний час на рефакторинг сейчас — сэкономишь дни потом. Если ты трогаешь код и не делаешь дизайн лучше, ты, скорее всего, делаешь его хуже.</p><p>Конечно, иногда бизнес держит паяльник у твоей жопы. Если правильный рефакторинг займет три месяца, а быстрый грязный хак — два часа, и дедлайн был вчера — придется говнокодить. Но сопротивляйся этому до последнего! Спроси себя: «Это реально лучшее, что я могу сделать в этих скотских условиях?». Может, можно сделать не идеально, но хотя бы не совсем убого за пару дней? Каждая контора должна выделять время на разгребание технического долга, иначе этот долг вас похоронит.</p><h2 id="_16-2-держи-комменты-рядом-с-кодом-а-не-в-голове-или-в-jira" tabindex="-1"><strong>16.2 Держи комменты рядом с кодом (А не в голове или в Jira)</strong> <a class="header-anchor" href="#_16-2-держи-комменты-рядом-с-кодом-а-не-в-голове-или-в-jira" aria-label="Permalink to &quot;**16.2 Держи комменты рядом с кодом (А не в голове или в Jira)**&quot;">​</a></h2><p>Когда ты меняешь код, старые комменты превращаются в наглый пиздёж. Забыть обновить коммент — святое дело. В итоге читатель видит одно, а код делает другое. Это бесит, и люди перестают верить комментам вообще. Но есть способ не быть мудаком.</p><p><strong>Держи комменты рядом с кодом.</strong> Чем дальше описание от мяса, тем меньше шансов, что ты его вспомнишь поправить. Например, описание интерфейса метода должно быть прямо над методом в файле с кодом. Ты всё равно туда полезешь править логику, увидишь коммент и (возможно) обновишь его.</p><p>Любители C/C++ сейчас начнут ныть про хедеры (.h файлы). Мол, интерфейс там. Но это далеко от тела функции. Разрабу лень открывать другой файл, чтобы поправить текст. Некоторые говорят: «Хедеры нужны, чтобы юзер видел API и не смотрел в кишки кода». Да срать я хотел на это. Юзеры должны читать доку, сгенерированную Doxygen или Javadoc, а не лазить по сырцам. А IDE сейчас умные, сами подтянут доку куда надо. Так что пиши там, где удобно <strong>тебе</strong> — рядом с кодом.</p><p>Внутри метода не надо сваливать все комменты в кучу сверху. Размажь их по коду. <em>Пример:</em> Вместо стены текста в начале, сделай так:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// План капкан (3 фазы):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. Ищем кандидатов</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. Ставим им оценки</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. Выбираем лучшего и выкидываем на мороз</span></span></code></pre></div><p>А детали пиши уже перед конкретными блоками кода. <strong>Правило:</strong> Чем дальше коммент от кода, тем более абстрактным он должен быть, чтобы не протухнуть при первой же мелкой правке.</p><h2 id="_16-3-комменты-принадлежат-коду-а-не-логам-коммитов-git-blame-не-спасет" tabindex="-1"><strong>16.3 Комменты принадлежат коду, а не логам коммитов (Git blame не спасет)</strong> <a class="header-anchor" href="#_16-3-комменты-принадлежат-коду-а-не-логам-коммитов-git-blame-не-спасет" aria-label="Permalink to &quot;**16.3 Комменты принадлежат коду, а не логам коммитов (Git blame не спасет)**&quot;">​</a></h2><p>Классическая ошибка долбоёба: расписать причину сложного изменения в Commit Message, а в коде оставить пустоту. Ты реально думаешь, что через год кто-то будет копаться в <code>git log</code>, чтобы понять, почему тут стоит этот костыль? Хер там. Даже если полезут, хрен найдут.</p><p>Пишешь коммит? Спроси себя: «Эта инфа пригодится потомкам?». Если да — <strong>пиши её в код</strong>. Пример: ты пофиксил хитрый баг. Если не написать об этом в коде, придет новый «умный» разраб, увидит «странный код», удалит твой фикс и вернет баг обратно. Git log — это кладбище истории, туда никто не ходит без крайней нужды. Код — вот где живут знания.</p><h2 id="_16-4-избегаи-дублирования-dry-в-документации-тоже-работает" tabindex="-1"><strong>16.4 Избегай дублирования (DRY в документации тоже работает)</strong> <a class="header-anchor" href="#_16-4-избегаи-дублирования-dry-в-документации-тоже-работает" aria-label="Permalink to &quot;**16.4 Избегай дублирования (DRY в документации тоже работает)**&quot;">​</a></h2><p>Второй способ держать комменты свежими — <strong>не копипастить</strong>. Если одно и то же написано в трех местах, ты поменяешь в одном и забудешь в двух других. Поздравляю, у тебя рассинхрон. Найди <strong>одно</strong> место для доки. В остальных поставь ссылку: <em>«Смотри описание переменной X, там всё разжевано»</em>. Если ссылка протухнет — это сразу видно (коммента нет), а если протухнет текст копипасты — ты будешь дебажить этот обман часами.</p><p>Если идеального места нет — создай файл <code>designNotes</code>.</p><p>И не надо пересказывать в комментах то, что делает другой модуль. Или переписывать спецификацию HTTP. <em>Пример:</em></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Реализует команду Foo. Читай мануал, там всё есть. Ссылка вот.</span></span></code></pre></div><p>Не пытайся переписать весь интернет в своих комментах. Просто дай ссылку.</p><h2 id="_16-5-проверяи-дифы-check-diffs-не-будь-животным-смотри-что-комитишь" tabindex="-1"><strong>16.5 Проверяй дифы (Check diffs): Не будь животным, смотри, что комитишь</strong> <a class="header-anchor" href="#_16-5-проверяи-дифы-check-diffs-не-будь-животным-смотри-что-комитишь" aria-label="Permalink to &quot;**16.5 Проверяй дифы (Check diffs): Не будь животным, смотри, что комитишь**&quot;">​</a></h2><p>Перед тем как набрать <code>git commit</code>, потрать две минуты и посмотри <code>git diff</code>. Пробегись глазами по тому, что ты наворотил. Это лучший способ заметить, что ты:</p><ol><li>Забыл обновить коммент.</li><li>Оставил <code>console.log(&quot;TEST KEK&quot;)</code>.</li><li>Забыл TODO.</li></ol><h2 id="_16-6-высокоуровневые-комменты-проще-поддерживать" tabindex="-1"><strong>16.6 Высокоуровневые комменты проще поддерживать</strong> <a class="header-anchor" href="#_16-6-высокоуровневые-комменты-проще-поддерживать" aria-label="Permalink to &quot;**16.6 Высокоуровневые комменты проще поддерживать**&quot;">​</a></h2><p>И напоследок: комменты, которые описывают <strong>ЧТО</strong> и <strong>ЗАЧЕМ</strong> (а не <em>КАК</em>), живут дольше. Детали реализации меняются часто, а общая суть — редко. Чем абстрактнее коммент, тем реже его надо переписывать. Пиши умно, а не дословно переводи код на человеческий.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/modifying-existing-code.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2026-01-30T07:47:46.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>15. Сначала комменты, потом код</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/a-philosophy-of-software-design/consistency.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>17. Консистентность</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"better-together-or-better-apart.md\":\"W-J-G8XG\",\"choosing-names.md\":\"BRchAqPp\",\"code-should-be-obvious.md\":\"MOyUKS_z\",\"comments-should-describe-things-that-are-not-obvious-from-the-code.md\":\"Bqhgb9pV\",\"conclusion.md\":\"5o4F6LCM\",\"consistency.md\":\"DiUE50GL\",\"decide-what-matters.md\":\"CojtYplH\",\"define-errors-out-of-existence.md\":\"pG7nbzk4\",\"design-it-twice.md\":\"BT6gyLBo\",\"designing-for-performance.md\":\"DS5l-x9B\",\"different-layer-different-abstraction.md\":\"DIwxl0c-\",\"general-purpose-modules-are-deeper.md\":\"Bh88fXbk\",\"index.md\":\"B8M4Nqzp\",\"information-hiding-and-leakage.md\":\"DOT9UaoS\",\"introduction.md\":\"CrOcZcdu\",\"modifying-existing-code.md\":\"DmSkHgx5\",\"modules-should-be-deep.md\":\"D28cz--x\",\"preface.md\":\"um68ntqA\",\"pull-complexity-downwards.md\":\"Bl6lcIAS\",\"software-trends.md\":\"Wc5eVcZz\",\"summary.md\":\"D0UDKKFw\",\"the-nature-of-complexity.md\":\"CDjwTGK4\",\"why-write-comments-the-four-excuses.md\":\"DfvhrYst\",\"working-code-is-not-enough.md\":\"1Y-OiXLT\",\"write-the-comments-first.md\":\"DcU5wKjW\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"ru-RU\",\"dir\":\"ltr\",\"title\":\"Философия дизайна ПО\",\"description\":\"A VitePress site\",\"base\":\"/a-philosophy-of-software-design/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"items\":[{\"text\":\"Предисловие\",\"link\":\"/preface\"},{\"text\":\"1. Введение\",\"link\":\"/introduction\"},{\"text\":\"2. Суть всей боли (Природа Сложности)\",\"link\":\"/the-nature-of-complexity\"},{\"text\":\"3. \\\"Работает — и ладно\\\" — девиз неудачников\",\"link\":\"/working-code-is-not-enough\"},{\"text\":\"4. Глубокие модули\",\"link\":\"/modules-should-be-deep\"},{\"text\":\"5. Прячем говно под ковер\",\"link\":\"/information-hiding-and-leakage\"},{\"text\":\"6. Универсальность модулей\",\"link\":\"/general-purpose-modules-are-deeper\"},{\"text\":\"7. Разные слои — разные абстракции\",\"link\":\"/different-layer-different-abstraction\"},{\"text\":\"8. Скидывай сложность вниз\",\"link\":\"/pull-complexity-downwards\"},{\"text\":\"9. Вместе или порознь?\",\"link\":\"/better-together-or-better-apart\"},{\"text\":\"10. Ошибок не существует\",\"link\":\"/define-errors-out-of-existence\"},{\"text\":\"11. Проектируй дважды\",\"link\":\"/design-it-twice\"},{\"text\":\"12. Зачем писать комменты?\",\"link\":\"/why-write-comments-the-four-excuses\"},{\"text\":\"13. Комментируй то, что не очевидно\",\"link\":\"/comments-should-describe-things-that-are-not-obvious-from-the-code\"},{\"text\":\"14. Нейминг\",\"link\":\"/choosing-names\"},{\"text\":\"15. Сначала комменты, потом код\",\"link\":\"/write-the-comments-first\"},{\"text\":\"16. Трогаем старый код\",\"link\":\"/modifying-existing-code\"},{\"text\":\"17. Консистентность\",\"link\":\"/consistency\"},{\"text\":\"18. Код должен быть понятен даже ежу\",\"link\":\"/code-should-be-obvious\"},{\"text\":\"19. Модные молодежные тренды\",\"link\":\"/software-trends\"},{\"text\":\"20. Производительность\",\"link\":\"/designing-for-performance\"},{\"text\":\"21. Определись, что важно\",\"link\":\"/decide-what-matters\"},{\"text\":\"22. Заключение\",\"link\":\"/conclusion\"},{\"text\":\"Шпаргалка\",\"link\":\"/summary\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Exoldy/a-philosophy-of-software-design/\"}],\"editLink\":{\"pattern\":\"https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>