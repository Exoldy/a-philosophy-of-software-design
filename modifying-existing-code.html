<!DOCTYPE html>
<html lang="ru-RU" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 16 Modifying Existing Code | Философия дизайна ПО</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/assets/style.CSPm08Rv.css" as="style">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/vp-icons.css" as="style">
    
    <script type="module" src="/a-philosophy-of-software-design/assets/app.DVEU4zNL.js"></script>
    <link rel="preload" href="/a-philosophy-of-software-design/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/theme.DDW5w42F.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/framework.CM3gOIkZ.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/modifying-existing-code.md.Bb3xXzrd.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/a-philosophy-of-software-design/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Философия дизайна ПО</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/preface.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>0 前言</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/introduction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>1 介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/the-nature-of-complexity.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>2 复杂度的本质</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/working-code-is-not-enough.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>3 可运行的代码是不够的</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>4 模块应深厚</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/information-hiding-and-leakage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>5 信息隐藏（和泄漏）</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6 General-Purpose Modules are Deeper</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/different-layer-different-abstraction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>7 Different Layer, Different Abstraction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/pull-complexity-downwards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>8 Pull Complexity Downwards</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/better-together-or-better-apart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>9 Better Together Or Better Apart?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/define-errors-out-of-existence.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10 Define Errors Out Of Existence</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/design-it-twice.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11 Design it Twice</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/why-write-comments-the-four-excuses.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12 Why Write Comments? The Four Excuses</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/comments-should-describe-things-that-are-not-obvious-from-the-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13 Comments Should Describe Things that Aren’t Obvious from the Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/choosing-names.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14 Choosing Names</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15 Write The Comments First</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modifying-existing-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16 Modifying Existing Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/consistency.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17 Consistency</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/code-should-be-obvious.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18 Code Should be Obvious</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/software-trends.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19 Software Trends</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/designing-for-performance.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20 Designing for Performance</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/decide-what-matters.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21 Decide What Matters</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/conclusion.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22 Conclusion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/summary.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Summary</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _a-philosophy-of-software-design_modifying-existing-code" data-v-39a288b8><div><h1 id="chapter-16-modifying-existing-code" tabindex="-1">Chapter 16 Modifying Existing Code <a class="header-anchor" href="#chapter-16-modifying-existing-code" aria-label="Permalink to &quot;Chapter 16 Modifying Existing Code&quot;">​</a></h1><p>Chapter 1 described how software development is iterative and incremental. A large software system develops through a series of evolutionary stages, where each stage adds new capabilities and modifies existing modules. This means that a system’s design is constantly evolving. It isn’t possible to conceive the right design for a system at the outset; the design of a mature system is determined more by changes made during the system’s evolution than by any initial conception. Previous chapters described how to squeeze out complexity during the initial design and implementation; this chapter discusses how to keep complexity from creeping in as the system evolves.</p><h2 id="_16-1-stay-strategic" tabindex="-1">16.1 Stay strategic <a class="header-anchor" href="#_16-1-stay-strategic" aria-label="Permalink to &quot;16.1 Stay strategic&quot;">​</a></h2><p>Chapter 3 introduced the distinction between tactical programming and strategic programming: in tactical programming, the primary goal is to get something working quickly, even if that results in additional complexity; in strategic programming, the most important goal is to produce a great system design. The tactical approach very quickly leads to a messy system design. If you want to have a system that is easy to maintain and enhance, then “working” isn’t a high enough standard; you have to prioritize design and think strategically. This idea also applies when you are modifying existing code.</p><p>Unfortunately, when developers go into existing code to make changes such as bug fixes or new features, they don’t usually think strategically. A typical mindset is “what is the smallest possible change I can make that does what I need?” Sometimes developers justify this because they are not comfortable with the code being modified; they worry that larger changes carry a greater risk of introducing new bugs. However, this results in tactical programming. Each one of these minimal changes introduces a few special cases, dependencies, or other forms of complexity. As a result, the system design gets just a bit worse, and the problems accumulate with each step in the system’s evolution.</p><p>If you want to maintain a clean design for a system, you must take a strategic approach when modifying existing code. Ideally, when you have finished with each change, the system will have the structure it would have had if you had designed it from the start with that change in mind. To achieve this goal, you must resist the temptation to make a quick fix. Instead, think about whether the current system design is still the best one, in light of the desired change. If not, refactor the system so that you end up with the best possible design. With this approach, the system design improves with every modification.</p><p>This is also an example of the investment mindset introduced on page 15: if you invest a little extra time to refactor and improve the system design, you’ll end up with a cleaner system. This will speed up development, and you will recoup the effort that you invested in the refactoring. Even if your particular change doesn’t require refactoring, you should still be on the lookout for design imperfections that you can fix while you’re in the code. Whenever you modify any code, try to find a way to improve the system design at least a little bit in the process. If you’re not making the design better, you are probably making it worse.</p><p>As discussed in Chapter 3, an investment mindset sometimes conflicts with the realities of commercial software development. If refactoring the system “the right way” would take three months but a quick and dirty fix would take only two hours, you may have to take the quick and dirty approach, particularly if you are working against a tight deadline. Or, if refactoring the system would create incompatibilities that affect many other people and teams, then the refactoring may not be practical.</p><p>Nonetheless, you should resist these compromises as much as possible. Ask yourself “Is this the best I can possibly do to create a clean system design, given my current constraints?” Perhaps there’s an alternative approach that would be almost as clean as the 3-month refactoring but could be done in a couple of days? Or, if you can’t afford to do a large refactoring now, get your boss to allocate time for you to come back to it after the current deadline. Every development organization should plan to spend a small fraction of its total effort on cleanup and refactoring; this work will pay for itself over the long run.</p><h2 id="_16-2-maintaining-comments-keep-the-comments-near-the-code" tabindex="-1">16.2 Maintaining comments: keep the comments near the code <a class="header-anchor" href="#_16-2-maintaining-comments-keep-the-comments-near-the-code" aria-label="Permalink to &quot;16.2 Maintaining comments: keep the comments near the code&quot;">​</a></h2><p>When you change existing code, there’s a good chance that the changes will invalidate some of the existing comments. It’s easy to forget to update comments when you modify code, which results in comments that are no longer accurate. Inaccurate comments are frustrating to readers, and if there are very many of them, readers begin to distrust all of the comments. Fortunately, with a little discipline and a couple of guiding rules, it’s possible to keep comments up-to-date without a huge effort. This section and the following ones put forth some specific techniques.</p><p>The best way to ensure that comments get updated is to position them close to the code they describe, so developers will see them when they change the code. The farther a comment is from its associated code, the less likely it is that it will be updated properly. For example, the best place for a method’s interface comment is in the code file, right next to the body of the method. Any changes to the method will involve this code, so the developer is likely to see the interface comments and update them if needed.</p><p>An alternative for languages like C and C++ that have separate code and header files, is to place the interface comments next to the method’s declaration in the .h file. However, this is a long way from the code; developers won’t see those comments when modifying the method’s body, and it takes additional work to open a different file and find the interface comments to update them. Some might argue that interface comments should go in header files so that users can learn how to use an abstraction without having to look at the code file. However, users should not need to read either code or header files; they should get their information from documentation compiled by tools such as Doxygen or Javadoc. In addition, many IDEs will extract and present documentation to users, such as by displaying a method’s documentation when the method’s name is typed. Given tools such as these, the documentation should be located in the place that is most convenient for developers working on the code.</p><p>When writing implementation comments, don’t put all the comments for an entire method at the top of the method. Spread them out, pushing each comment down to the narrowest scope that includes all of the code referred to by the comment. For example, if a method has three major phases, don’t write one comment at the top of the method that describes all of the phases in detail. Instead, write a separate comment for each phase and position that comment just above the first line of code in that phase. On the other hand, it can also be helpful to have a comment at the top of a method’s implementation that describes the overall strategy, like this:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  We proceed in three phases:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  Phase 1: Find feasible candidates</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  Phase 2: Assign each candidate a score</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  Phase 3: Choose the best, and remove it</span></span></code></pre></div><p>Additional details can be documented just above the code for each phase.</p><p>In general, the farther a comment is from the code it describes, the more abstract it should be (this reduces the likelihood that the comment will be invalidated by code changes).</p><h2 id="_16-3-comments-belong-in-the-code-not-the-commit-log" tabindex="-1">16.3 Comments belong in the code, not the commit log <a class="header-anchor" href="#_16-3-comments-belong-in-the-code-not-the-commit-log" aria-label="Permalink to &quot;16.3 Comments belong in the code, not the commit log&quot;">​</a></h2><p>A common mistake when modifying code is to put detailed information about the change in the commit message for the source code repository, but then not to document it in the code. Although commit messages can be browsed in the future by scanning the repository’s log, a developer who needs the information is unlikely to think of scanning the repository log. Even if they do scan the log, it will be tedious to find the right log message.</p><p>When writing a commit message, ask yourself whether developers will need to use that information in the future. If so, then document this information in the code. An example is a commit message describing a subtle problem that motivated a code change. If this isn’t documented in the code, then a developer might come along later and undo the change without realizing that they have re-created a bug. If you want to include a copy of this information in the commit message as well, that’s fine, but the most important thing is to get it in the code. This illustrates the principle of placing documentation in the place where developers are most likely to see it; the commit log is rarely that place.</p><h2 id="_16-4-maintaining-comments-avoid-duplication" tabindex="-1">16.4 Maintaining comments: avoid duplication <a class="header-anchor" href="#_16-4-maintaining-comments-avoid-duplication" aria-label="Permalink to &quot;16.4 Maintaining comments: avoid duplication&quot;">​</a></h2><p>The second technique for keeping comments up to date is to avoid duplication. If documentation is duplicated, it is more difficult for developers to find and update all of the relevant copies. Instead, try to document each design decision exactly once. If there are multiple places in the code that are affected by a particular decision, don’t repeat the documentation at each of these points. Instead, find the most obvious single place to put the documentation. For example, suppose there is tricky behavior related to a variable, which affects several different places where the variable is used. You can document that behavior in the comment next to the variable’s declaration. This is a natural place that developers are likely to check if they’re having trouble understanding code that uses the variable.</p><p>If there is no “obvious” single place to put a particular piece of documentation where developers will find it, create a designNotes file as described in Section 13.7. Or, pick the best of the available places and put the documentation there. In addition, add short comments in the other places that refer to the central location: “See the comment in xyz for an explanation of the code below.” If the reference becomes obsolete because the master comment was moved or deleted, this inconsistency will be self-evident because developers won’t find the comment at the indicated place; they can use revision control history to find out what happened to the comment and then update the reference. In contrast, if the documentation is duplicated and some of the copies don’t get updated, there will be no indication to developers that they are using stale information.</p><p>Don’t redocument one module’s design decisions in another module. For example, don’t put comments before a method call that explain what happens in the called method. If readers want to know, they should look at the interface comments for the method. Good development tools will usually provide this information automatically, for example, by displaying the interface comments for a method if you select the method’s name or hover the mouse over it. Try to make it easy for developers to find appropriate documentation, but don’t do it by repeating the documentation.</p><p>If information is already documented someplace outside your program, don’t repeat the documentation inside the program; just reference the external documentation. For example, if you write a class that implements the HTTP protocol, there’s no need for you to describe the HTTP protocol inside your code. There are already numerous sources for this documentation on the Web; just add a short comment to your code with a URL for one of these sources. Another example is features that are already documented in a user manual. Suppose you are writing a program that implements a collection of commands, with one method responsible for implementing each command. If there is a user manual that describes those commands, there’s no need to duplicate this information in the code. Instead, include a short note like the following in the interface comment for each command method:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Implements the Foo command; see the user manual for details.</span></span></code></pre></div><p>It’s important that readers can easily find all the documentation needed to understand your code, but that doesn’t mean you have to write all of that documentation.</p><h2 id="_16-5-maintaining-comments-check-the-diffs" tabindex="-1">16.5 Maintaining comments: check the diffs <a class="header-anchor" href="#_16-5-maintaining-comments-check-the-diffs" aria-label="Permalink to &quot;16.5 Maintaining comments: check the diffs&quot;">​</a></h2><p>One good way to make sure documentation stays up to date is to take a few minutes before committing a change to your revision control system to scan over all the changes for that commit; make sure that each change is properly reflected in the documentation. These pre-commit scans will also detect several other problems, such as accidentally leaving debugging code in the system or failing to fix TODO items.</p><h2 id="_16-6-higher-level-comments-are-easier-to-maintain" tabindex="-1">16.6 Higher-level comments are easier to maintain <a class="header-anchor" href="#_16-6-higher-level-comments-are-easier-to-maintain" aria-label="Permalink to &quot;16.6 Higher-level comments are easier to maintain&quot;">​</a></h2><p>One final thought on maintaining documentation: comments are easier to maintain if they are higher-level and more abstract than the code. These comments do not reflect the details of the code, so they will not be affected by minor code changes; only changes in overall behavior will affect these comments. Of course, as discussed in Chapter 13, some comments do need to be detailed and precise. But in general, the comments that are most useful (they don’t simply repeat the code) are also easiest to maintain.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/modifying-existing-code.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2026-01-29T23:47:00.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>15 Write The Comments First</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/a-philosophy-of-software-design/consistency.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>17 Consistency</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"better-together-or-better-apart.md\":\"C0Re2gBG\",\"choosing-names.md\":\"BNaXuhU4\",\"code-should-be-obvious.md\":\"DuAJs_cN\",\"comments-should-describe-things-that-are-not-obvious-from-the-code.md\":\"DjbT_s5A\",\"conclusion.md\":\"Dy_d-oLp\",\"consistency.md\":\"C6YaGoya\",\"decide-what-matters.md\":\"D6l-H0FO\",\"define-errors-out-of-existence.md\":\"BswmT4vb\",\"design-it-twice.md\":\"Bslb1_1E\",\"designing-for-performance.md\":\"v8G7p4rP\",\"different-layer-different-abstraction.md\":\"Bfssr-Fj\",\"general-purpose-modules-are-deeper.md\":\"BkHJyoVX\",\"index.md\":\"fo_7tkhg\",\"information-hiding-and-leakage.md\":\"CfJ7eQmT\",\"introduction.md\":\"C6_7SNCh\",\"modifying-existing-code.md\":\"Bb3xXzrd\",\"modules-should-be-deep.md\":\"CvT8DAqj\",\"preface.md\":\"CKdk7eHk\",\"pull-complexity-downwards.md\":\"2NnZC4oM\",\"software-trends.md\":\"ZB58LNvW\",\"summary.md\":\"daIPZ1v8\",\"the-nature-of-complexity.md\":\"CzYVihvT\",\"why-write-comments-the-four-excuses.md\":\"BOsjNHGD\",\"working-code-is-not-enough.md\":\"CA30L1NO\",\"write-the-comments-first.md\":\"DOyD-Se8\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"ru-RU\",\"dir\":\"ltr\",\"title\":\"Философия дизайна ПО\",\"description\":\"A VitePress site\",\"base\":\"/a-philosophy-of-software-design/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"items\":[{\"text\":\"0 前言\",\"link\":\"/preface\"},{\"text\":\"1 介绍\",\"link\":\"/introduction\"},{\"text\":\"2 复杂度的本质\",\"link\":\"/the-nature-of-complexity\"},{\"text\":\"3 可运行的代码是不够的\",\"link\":\"/working-code-is-not-enough\"},{\"text\":\"4 模块应深厚\",\"link\":\"/modules-should-be-deep\"},{\"text\":\"5 信息隐藏（和泄漏）\",\"link\":\"/information-hiding-and-leakage\"},{\"text\":\"6 General-Purpose Modules are Deeper\",\"link\":\"/general-purpose-modules-are-deeper\"},{\"text\":\"7 Different Layer, Different Abstraction\",\"link\":\"/different-layer-different-abstraction\"},{\"text\":\"8 Pull Complexity Downwards\",\"link\":\"/pull-complexity-downwards\"},{\"text\":\"9 Better Together Or Better Apart?\",\"link\":\"/better-together-or-better-apart\"},{\"text\":\"10 Define Errors Out Of Existence\",\"link\":\"/define-errors-out-of-existence\"},{\"text\":\"11 Design it Twice\",\"link\":\"/design-it-twice\"},{\"text\":\"12 Why Write Comments? The Four Excuses\",\"link\":\"/why-write-comments-the-four-excuses\"},{\"text\":\"13 Comments Should Describe Things that Aren’t Obvious from the Code\",\"link\":\"/comments-should-describe-things-that-are-not-obvious-from-the-code\"},{\"text\":\"14 Choosing Names\",\"link\":\"/choosing-names\"},{\"text\":\"15 Write The Comments First\",\"link\":\"/write-the-comments-first\"},{\"text\":\"16 Modifying Existing Code\",\"link\":\"/modifying-existing-code\"},{\"text\":\"17 Consistency\",\"link\":\"/consistency\"},{\"text\":\"18 Code Should be Obvious\",\"link\":\"/code-should-be-obvious\"},{\"text\":\"19 Software Trends\",\"link\":\"/software-trends\"},{\"text\":\"20 Designing for Performance\",\"link\":\"/designing-for-performance\"},{\"text\":\"21 Decide What Matters\",\"link\":\"/decide-what-matters\"},{\"text\":\"22 Conclusion\",\"link\":\"/conclusion\"},{\"text\":\"Summary\",\"link\":\"/summary\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Exoldy/a-philosophy-of-software-design/\"}],\"editLink\":{\"pattern\":\"https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>