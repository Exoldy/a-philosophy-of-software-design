<!DOCTYPE html>
<html lang="ru-RU" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5. Прячем говно под ковер (Сокрытие информации и утечки) | Философия дизайна ПО</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/assets/style.CSPm08Rv.css" as="style">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/vp-icons.css" as="style">
    
    <script type="module" src="/a-philosophy-of-software-design/assets/app.DVEU4zNL.js"></script>
    <link rel="preload" href="/a-philosophy-of-software-design/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/theme.DDW5w42F.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/framework.CM3gOIkZ.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/information-hiding-and-leakage.md.CiTXS6ET.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/a-philosophy-of-software-design/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Философия дизайна ПО</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/preface.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>0 前言</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/introduction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>1 介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/the-nature-of-complexity.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>2 复杂度的本质</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/working-code-is-not-enough.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>3 可运行的代码是不够的</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>4 模块应深厚</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/information-hiding-and-leakage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>5 信息隐藏（和泄漏）</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6 General-Purpose Modules are Deeper</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/different-layer-different-abstraction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>7 Different Layer, Different Abstraction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/pull-complexity-downwards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>8 Pull Complexity Downwards</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/better-together-or-better-apart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>9 Better Together Or Better Apart?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/define-errors-out-of-existence.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10 Define Errors Out Of Existence</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/design-it-twice.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11 Design it Twice</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/why-write-comments-the-four-excuses.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12 Why Write Comments? The Four Excuses</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/comments-should-describe-things-that-are-not-obvious-from-the-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13 Comments Should Describe Things that Aren’t Obvious from the Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/choosing-names.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14 Choosing Names</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15 Write The Comments First</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modifying-existing-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16 Modifying Existing Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/consistency.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17 Consistency</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/code-should-be-obvious.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18 Code Should be Obvious</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/software-trends.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19 Software Trends</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/designing-for-performance.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20 Designing for Performance</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/decide-what-matters.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21 Decide What Matters</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/conclusion.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22 Conclusion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/summary.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Summary</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _a-philosophy-of-software-design_information-hiding-and-leakage" data-v-39a288b8><div><h1 id="_5-прячем-говно-под-ковер-сокрытие-информации-и-утечки" tabindex="-1"><strong>5. Прячем говно под ковер (Сокрытие информации и утечки)</strong> <a class="header-anchor" href="#_5-прячем-говно-под-ковер-сокрытие-информации-и-утечки" aria-label="Permalink to &quot;**5. Прячем говно под ковер (Сокрытие информации и утечки)**&quot;">​</a></h1><p>В прошлой главе мы выяснили, что модули должны быть глубокими. В этой (и следующих) главах мы разберем техники, как сделать так, чтобы твой код был действительно глубоким, а не просто запутанным куском... ну ты понял.</p><h2 id="_5-1-сокрытие-информации-инкапсуляция-для-взрослых" tabindex="-1"><strong>5.1 Сокрытие информации (Инкапсуляция для взрослых)</strong> <a class="header-anchor" href="#_5-1-сокрытие-информации-инкапсуляция-для-взрослых" aria-label="Permalink to &quot;**5.1 Сокрытие информации (Инкапсуляция для взрослых)**&quot;">​</a></h2><p>Самая главная техника для создания глубоких модулей — это <strong>сокрытие информации</strong>. Эту фишку придумал Дэвид Парнас ещё в лохматые 70-е. Базовая идея проста: каждый модуль должен инкапсулировать (читай: прятать внутри себя) кусок знаний о том, как всё устроено. Эти знания живут внутри реализации, но в интерфейсе их не видно. Другим модулям вообще не всралось знать, что у тебя там под капотом.</p><p>Обычно прячут детали реализации механизмов. Примеры того, что нормальные люди прячут внутри модуля:</p><ul><li>Как хранить данные в B-дереве и искать их там, не умирая от старости.</li><li>Как мапить логические блоки файла на физические сектора диска (тебе оно надо?).</li><li>Как на самом деле работает протокол TCP (поверь, ты не хочешь этого знать).</li><li>Как шедулить потоки на многоядерном проце.</li><li>Как парсить этот сраный JSON.</li></ul><hr><p>Скрытая инфа — это структуры данных и алгоритмы. Это могут быть низкоуровневые детали (типа размера страницы памяти) или высокоуровневые абстракции (типа предположения, что &quot;большинство файлов маленькие, так что похер&quot;).</p><p>Сокрытие информации снижает сложность двумя путями:</p><ol><li><strong>Упрощает интерфейс.</strong> Интерфейс становится чище и абстрактнее. Это снижает когнитивную нагрузку на разраба. Если ты юзаешь класс B-дерева, тебе насрать на балансировку узлов. Ты просто говоришь: &quot;Найди мне X&quot;, и оно находит.</li><li><strong>Упрощает эволюцию системы.</strong> Если ты спрятал кишки модуля внутри, то снаружи от них никто не зависит. Захотел поменять реализацию TCP? Меняй. Верхнеуровневый код, который просто шлет байтики, даже не чихнет.</li></ol><p><strong>Совет:</strong> Когда дизайнишь новый модуль, крепко подумай, какую инфу можно заныкать. Чем больше ты спрячешь, тем проще будет интерфейс, и тем глубже будет модуль.</p><p><strong>Важное примечание:</strong> Объявить переменные и методы <code>private</code> — это еще не сокрытие информации. Если ты сделал переменную приватной, но налепил к ней публичные геттеры и сеттеры, то ты, по сути, просто выставил её напоказ. Ты ничего не спрятал, ты просто добавил бюрократии.</p><p>Лучшая форма сокрытия — когда инфа вообще не видна снаружи. Но частичное сокрытие тоже катит. Если какая-то фича нужна только паре фриков, спрячь её за отдельными методами, чтобы нормальные люди не спотыкались об неё в основных сценариях.</p><h2 id="_5-2-утечки-информации-когда-кишки-торчат-наружу" tabindex="-1"><strong>5.2 Утечки информации (Когда кишки торчат наружу)</strong> <a class="header-anchor" href="#_5-2-утечки-информации-когда-кишки-торчат-наружу" aria-label="Permalink to &quot;**5.2 Утечки информации (Когда кишки торчат наружу)**&quot;">​</a></h2><p>Противоположность сокрытия — <strong>утечка информации</strong>. Это когда твое &quot;гениальное&quot; архитектурное решение размазано по нескольким модулям. Это создает зависимость: поменял что-то в одном месте — иди правь в пяти других.</p><p>Если деталь реализации торчит в интерфейсе — это официальная утечка. Но бывает и хуже: <strong>скрытая утечка</strong>. Представь два класса, которые оба знают про формат какого-то файла. Даже если они не светят это в интерфейсе, они оба зависят от этого формата. Поменял формат — переписывай оба класса. Такая утечка через задний проход (back-door leakage) — самая подлая херня, потому что её не видно сразу.</p><p>Утечка информации — это жирнющий красный флаг. Хороший дизайнер чует утечку за версту. Видишь утечку? Спроси себя: &quot;Как мне перетасовать классы так, чтобы это знание жило только в одном месте?&quot;. Иногда проще слить два мелких класса в один большой, чем трахаться с зависимостями. Или вынести эту инфу в третий, новый класс. Но только если у него будет простой интерфейс, иначе ты просто переложил говно из одной кучи в другую.</p><blockquote><p><strong>АХТУНГ: Утечка информации</strong> Утечка происходит, когда одно и то же знание используется в разных местах. Например, два разных класса знают структуру одного файла. Поменяешь файл — сломаешь оба класса.</p></blockquote><h2 id="_5-3-временная-декомпозиция-зло-во-плоти" tabindex="-1"><strong>5.3 Временная декомпозиция (Зло во плоти)</strong> <a class="header-anchor" href="#_5-3-временная-декомпозиция-зло-во-плоти" aria-label="Permalink to &quot;**5.3 Временная декомпозиция (Зло во плоти)**&quot;">​</a></h2><p>Частая причина утечек — стиль дизайна, который я называю <strong>временнóй декомпозицией</strong>. Это когда ты структурируешь систему по порядку действий во времени.</p><p>Типа: &quot;Сначала мы читаем файл, потом меняем данные, потом пишем файл&quot;. И ты, недолго думая, пилишь три класса: <code>FileReader</code>, <code>DataModifier</code>, <code>FileWriter</code>. В итоге и читатель, и писатель знают про формат файла. Поздравляю, у тебя утечка.</p><p>Решение: запихни чтение и запись в один класс, который шарит за формат файла. В ловушку временной декомпозиции легко попасть, потому что ты, когда кодишь, думаешь алгоритмом: &quot;сначала это, потом то&quot;. Но архитектура должна строиться вокруг <strong>знаний</strong>, а не вокруг <strong>порядка действий</strong>.</p><blockquote><p><strong>АХТУНГ: Временная декомпозиция</strong> Это когда структура кода повторяет порядок выполнения. Операции, которые происходят в разное время, разлетаются по разным классам. Если одно знание нужно на разных этапах, оно дублируется, и мы получаем утечку.</p></blockquote><h2 id="_5-4-пример-http-сервер-разбор-полетов" tabindex="-1"><strong>5.4 Пример: HTTP сервер (Разбор полетов)</strong> <a class="header-anchor" href="#_5-4-пример-http-сервер-разбор-полетов" aria-label="Permalink to &quot;**5.4 Пример: HTTP сервер (Разбор полетов)**&quot;">​</a></h2><p>Давайте посмотрим на студентов, которые писали HTTP-сервер. На их ошибках учиться веселее.</p><p>HTTP — это протокол, по которому браузер базарит с сервером. Запрос — это текст. Студентам надо было написать классы для приема запросов и отправки ответов.</p><p><em>(Тут была картинка с HTTP запросом, но ты и так знаешь, как выглядит POST-запрос, не маленький).</em></p><h2 id="_5-5-пример-слишком-дохера-классов" tabindex="-1"><strong>5.5 Пример: Слишком дохера классов</strong> <a class="header-anchor" href="#_5-5-пример-слишком-дохера-классов" aria-label="Permalink to &quot;**5.5 Пример: Слишком дохера классов**&quot;">​</a></h2><p>Главный косяк студентов — они наплодили кучу мелких, плоских классов. Одна команда сделала два класса для приема запроса: первый вычитывает байты из сокета в строку, второй парсит эту строку. Это классическая <strong>временная декомпозиция</strong>: &quot;сначала читаем, потом парсим&quot;. Проблема в том, что ты не можешь нормально прочитать запрос, не распарсив его (тебе надо знать <code>Content-Length</code>, чтобы понять, сколько читать). В итоге оба класса должны знать структуру HTTP. Код дублируется, сложность растет, вызывающий код должен дергать два метода в строгом порядке. Бред.</p><p>Было бы лучше слить их в один класс. Это улучшает сокрытие информации (все знания о формате HTTP в одном месте) и упрощает жизнь (вызвал один метод и забыл).</p><p>Этот пример иллюстрирует важную мысль: <strong>иногда жирный класс — это хорошо</strong>. Объединение кода в одном месте позволяет спрятать кишки и дать наружу простой интерфейс.</p><p>Конечно, не надо делать <code>GodObject</code>, который делает вообще всё. Но об этом в 9-й главе.</p><h2 id="_5-6-пример-обработка-параметров-http" tabindex="-1"><strong>5.6 Пример: Обработка параметров HTTP</strong> <a class="header-anchor" href="#_5-6-пример-обработка-параметров-http" aria-label="Permalink to &quot;**5.6 Пример: Обработка параметров HTTP**&quot;">​</a></h2><p>Серверу нужно достать параметры из запроса (типа <code>photo_id</code> или <code>comment</code>). Они могут быть в URL, могут быть в теле, и они еще закодированы (всякие <code>%20</code> вместо пробелов).</p><p>Что студенты сделали хорошо:</p><ol><li>Спрятали разницу между параметрами в URL и в теле. Вызывающему пофиг, где был параметр.</li><li>Спрятали URL-декодирование. Сервер отдает уже нормальный текст &quot;Hello World&quot;, а не &quot;Hello%20World&quot;.</li></ol><p>Где они облажались: Почти все сделали метод типа такого:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String, String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.params;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Это, блядь, фиаско. Метод возвращает ссылку на внутреннюю <code>Map</code>.</p><ol><li>Это <strong>плоский интерфейс</strong>. Ты вываливаешь свои кишки (внутреннюю структуру данных) наружу. Захочешь поменять <code>Map</code> на что-то другое — переписывай весь проект.</li><li>Это неудобно. Юзеру надо вызвать <code>getParams()</code>, получить карту, потом дергать карту.</li><li>Это опасно. Юзер может случайно (или специально) поменять эту карту и сломать состояние объекта <code>HTTPRequest</code>.</li></ol><p>Нормальный пацанский интерфейс выглядит так:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String name) { ... }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getIntParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String name) { ... }</span></span></code></pre></div><p><code>getParameter</code> прячет структуру хранения. <code>getIntParameter</code> сразу парсит строку в число. Это удобно: не надо самому делать <code>Integer.parseInt</code> и ловить эксепшены каждый раз. Это пример <strong>глубокого интерфейса</strong>.</p><h2 id="_5-7-пример-дефолтные-значения-в-ответах" tabindex="-1"><strong>5.7 Пример: Дефолтные значения в ответах</strong> <a class="header-anchor" href="#_5-7-пример-дефолтные-значения-в-ответах" aria-label="Permalink to &quot;**5.7 Пример: Дефолтные значения в ответах**&quot;">​</a></h2><p>Еще одна боль — создание ответов. Студенты заставляли юзера указывать версию HTTP при создании ответа. Алло! Версия ответа должна совпадать с версией запроса. Библиотека сама знает запрос, пусть сама и подставит версию. Юзер вообще может не знать, какая там версия. То же самое с датой (<code>Date</code> header). Библиотека должна ставить текущее время по дефолту.</p><p><strong>Дефолты</strong> — это круто. Они делают интерфейс простым для 99% случаев. Если кому-то реально надо переопределить дату — дай ему отдельный метод. Но по умолчанию всё должно работать &quot;из коробки&quot;.</p><p>Хороший класс должен делать правильные вещи, не заставляя тебя умолять об этом. Плохой пример — Java I/O. Чтобы получить буферизацию (которая нужна всем и всегда), ты должен явно обернуть стрим в <code>BufferedInputStream</code>. Какого хера? Оно должно быть включено по дефолту! Лучшие фичи — это те, о существовании которых ты даже не догадываешься, потому что они просто работают.</p><blockquote><p><strong>АХТУНГ: Эксгибиционизм в API</strong> Если для простой задачи API заставляет меня изучать настройки, которые нужны раз в сто лет — это плохой дизайн. Это грузит мозг.</p></blockquote><h2 id="_5-8-прячем-инфу-внутри-класса" tabindex="-1"><strong>5.8 Прячем инфу внутри класса</strong> <a class="header-anchor" href="#_5-8-прячем-инфу-внутри-класса" aria-label="Permalink to &quot;**5.8 Прячем инфу внутри класса**&quot;">​</a></h2><p>Сокрытие работает не только для публичных API. Внутри класса тоже надо прятать говно. Дизайни приватные методы и переменные так, чтобы минимизировать доступ к ним. Если переменная используется во всем классе — это повод напрячься. Если можно ограничить её использование парой методов — сделай это. Чем меньше мест, где трогают данные, тем меньше шансов, что какой-то джун их запорет.</p><h2 id="_5-9-когда-перегнул-палку-заставь-дурака-богу-молиться" tabindex="-1"><strong>5.9 Когда перегнул палку (Заставь дурака богу молиться...)</strong> <a class="header-anchor" href="#_5-9-когда-перегнул-палку-заставь-дурака-богу-молиться" aria-label="Permalink to &quot;**5.9 Когда перегнул палку (Заставь дурака богу молиться...)**&quot;">​</a></h2><p>Сокрытие имеет смысл, только если инфа не нужна снаружи. Если параметр реально нужен юзеру для настройки производительности — <strong>не прячь его</strong>. Выставь его в интерфейс. Твоя цель — минимизировать инфу, которая <em>нужна</em> снаружи, а не скрывать то, без чего работать невозможно. Если модуль может настроиться сам — круто. Если нет — дай ручку настройки, не будь мудаком.</p><h2 id="_5-10-итог" tabindex="-1"><strong>5.10 Итог</strong> <a class="header-anchor" href="#_5-10-итог" aria-label="Permalink to &quot;**5.10 Итог**&quot;">​</a></h2><p>Сокрытие информации и глубокие модули — это братья навек. Чем больше ты прячешь, тем глубже модуль. Чем больше ты вываливаешь наружу, тем он более плоский и убогий.</p><p>Когда нарезаешь систему на модули:</p><ol><li>Забей на порядок действий во времени (это путь к временной декомпозиции и страданиям).</li><li>Думай о <strong>знаниях</strong>.</li><li>Инкапсулируй каждое знание в отдельный модуль.</li></ol><p>Так победишь.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/information-hiding-and-leakage.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2026-01-30T00:36:57.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>4 模块应深厚</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>6 General-Purpose Modules are Deeper</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"better-together-or-better-apart.md\":\"DNaJNdlj\",\"choosing-names.md\":\"DgfK3qCE\",\"code-should-be-obvious.md\":\"BhpGekVF\",\"comments-should-describe-things-that-are-not-obvious-from-the-code.md\":\"DDxCQu_2\",\"conclusion.md\":\"BVQFShrs\",\"consistency.md\":\"DyONwOZq\",\"decide-what-matters.md\":\"B6wN2nUp\",\"define-errors-out-of-existence.md\":\"qjLqEUOH\",\"design-it-twice.md\":\"DcQDvsT_\",\"designing-for-performance.md\":\"D_QZ2OjP\",\"different-layer-different-abstraction.md\":\"CRZY8XaA\",\"general-purpose-modules-are-deeper.md\":\"aAqTdHh6\",\"index.md\":\"B5V6D5lk\",\"information-hiding-and-leakage.md\":\"CiTXS6ET\",\"introduction.md\":\"DFClh1a9\",\"modifying-existing-code.md\":\"8mLnmvBl\",\"modules-should-be-deep.md\":\"B6TtPA-P\",\"preface.md\":\"CPzCorsX\",\"pull-complexity-downwards.md\":\"Ec_WwNdZ\",\"software-trends.md\":\"BOxVBBzj\",\"summary.md\":\"kUQYCcZZ\",\"the-nature-of-complexity.md\":\"DL13SPRn\",\"why-write-comments-the-four-excuses.md\":\"Dj9kfpqx\",\"working-code-is-not-enough.md\":\"B65y29y0\",\"write-the-comments-first.md\":\"Cf80YHPH\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"ru-RU\",\"dir\":\"ltr\",\"title\":\"Философия дизайна ПО\",\"description\":\"A VitePress site\",\"base\":\"/a-philosophy-of-software-design/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"items\":[{\"text\":\"0 前言\",\"link\":\"/preface\"},{\"text\":\"1 介绍\",\"link\":\"/introduction\"},{\"text\":\"2 复杂度的本质\",\"link\":\"/the-nature-of-complexity\"},{\"text\":\"3 可运行的代码是不够的\",\"link\":\"/working-code-is-not-enough\"},{\"text\":\"4 模块应深厚\",\"link\":\"/modules-should-be-deep\"},{\"text\":\"5 信息隐藏（和泄漏）\",\"link\":\"/information-hiding-and-leakage\"},{\"text\":\"6 General-Purpose Modules are Deeper\",\"link\":\"/general-purpose-modules-are-deeper\"},{\"text\":\"7 Different Layer, Different Abstraction\",\"link\":\"/different-layer-different-abstraction\"},{\"text\":\"8 Pull Complexity Downwards\",\"link\":\"/pull-complexity-downwards\"},{\"text\":\"9 Better Together Or Better Apart?\",\"link\":\"/better-together-or-better-apart\"},{\"text\":\"10 Define Errors Out Of Existence\",\"link\":\"/define-errors-out-of-existence\"},{\"text\":\"11 Design it Twice\",\"link\":\"/design-it-twice\"},{\"text\":\"12 Why Write Comments? The Four Excuses\",\"link\":\"/why-write-comments-the-four-excuses\"},{\"text\":\"13 Comments Should Describe Things that Aren’t Obvious from the Code\",\"link\":\"/comments-should-describe-things-that-are-not-obvious-from-the-code\"},{\"text\":\"14 Choosing Names\",\"link\":\"/choosing-names\"},{\"text\":\"15 Write The Comments First\",\"link\":\"/write-the-comments-first\"},{\"text\":\"16 Modifying Existing Code\",\"link\":\"/modifying-existing-code\"},{\"text\":\"17 Consistency\",\"link\":\"/consistency\"},{\"text\":\"18 Code Should be Obvious\",\"link\":\"/code-should-be-obvious\"},{\"text\":\"19 Software Trends\",\"link\":\"/software-trends\"},{\"text\":\"20 Designing for Performance\",\"link\":\"/designing-for-performance\"},{\"text\":\"21 Decide What Matters\",\"link\":\"/decide-what-matters\"},{\"text\":\"22 Conclusion\",\"link\":\"/conclusion\"},{\"text\":\"Summary\",\"link\":\"/summary\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Exoldy/a-philosophy-of-software-design/\"}],\"editLink\":{\"pattern\":\"https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>