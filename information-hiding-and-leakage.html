<!DOCTYPE html>
<html lang="ru-RU" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第五章 信息隐藏（和泄漏） | Философия дизайна ПО</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/assets/style.CSPm08Rv.css" as="style">
    <link rel="preload stylesheet" href="/a-philosophy-of-software-design/vp-icons.css" as="style">
    
    <script type="module" src="/a-philosophy-of-software-design/assets/app.DVEU4zNL.js"></script>
    <link rel="preload" href="/a-philosophy-of-software-design/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/theme.DDW5w42F.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/chunks/framework.CM3gOIkZ.js">
    <link rel="modulepreload" href="/a-philosophy-of-software-design/assets/information-hiding-and-leakage.md.BrAPnQBd.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/a-philosophy-of-software-design/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Философия дизайна ПО</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Exoldy/a-philosophy-of-software-design/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/preface.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>0 前言</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/introduction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>1 介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/the-nature-of-complexity.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>2 复杂度的本质</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/working-code-is-not-enough.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>3 可运行的代码是不够的</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>4 模块应深厚</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/information-hiding-and-leakage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>5 信息隐藏（和泄漏）</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6 General-Purpose Modules are Deeper</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/different-layer-different-abstraction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>7 Different Layer, Different Abstraction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/pull-complexity-downwards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>8 Pull Complexity Downwards</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/better-together-or-better-apart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>9 Better Together Or Better Apart?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/define-errors-out-of-existence.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10 Define Errors Out Of Existence</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/design-it-twice.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11 Design it Twice</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/why-write-comments-the-four-excuses.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12 Why Write Comments? The Four Excuses</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/comments-should-describe-things-that-are-not-obvious-from-the-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13 Comments Should Describe Things that Aren’t Obvious from the Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/choosing-names.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14 Choosing Names</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/write-the-comments-first.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15 Write The Comments First</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/modifying-existing-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16 Modifying Existing Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/consistency.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17 Consistency</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/code-should-be-obvious.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18 Code Should be Obvious</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/software-trends.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19 Software Trends</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/designing-for-performance.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20 Designing for Performance</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/decide-what-matters.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21 Decide What Matters</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/conclusion.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22 Conclusion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/a-philosophy-of-software-design/summary.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Summary</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _a-philosophy-of-software-design_information-hiding-and-leakage" data-v-39a288b8><div><h1 id="第五章-信息隐藏-和泄漏" tabindex="-1">第五章 信息隐藏（和泄漏） <a class="header-anchor" href="#第五章-信息隐藏-和泄漏" aria-label="Permalink to &quot;第五章 信息隐藏（和泄漏）&quot;">​</a></h1><p>Chapter 4 argued that modules should be deep. This chapter, and the next few that follow, discuss techniques for creating deep modules.</p><h2 id="_5-1-information-hiding" tabindex="-1">5.1 Information hiding <a class="header-anchor" href="#_5-1-information-hiding" aria-label="Permalink to &quot;5.1 Information hiding&quot;">​</a></h2><p>The most important technique for achieving deep modules is <em>information hiding</em>. This technique was first described by David Parnas1. The basic idea is that each module should encapsulate a few pieces of knowledge, which represent design decisions. The knowledge is embedded in the module’s implementation but does not appear in its interface, so it is not visible to other modules.</p><p>The information hidden within a module usually consists of details about how to implement some mechanism. Here are some examples of information that might be hidden within a module:</p><ul><li>How to store information in a B-tree, and how to access it efficiently.</li><li>How to identify the physical disk block corresponding to each logical block within a file.</li><li>How to implement the TCP network protocol.</li><li>How to schedule threads on a multi-core processor.</li><li>How to parse JSON documents.</li></ul><hr><p>The hidden information includes data structures and algorithms related to the mechanism. It can also include lower-level details such as the size of a page, and it can include higher-level concepts that are more abstract, such as an assumption that most files are small.</p><p>Information hiding reduces complexity in two ways. First, it simplifies the interface to a module. The interface reflects a simpler, more abstract view of the module’s functionality and hides the details; this reduces the cognitive load on developers who use the module. For instance, a developer using a B-tree class need not worry about the ideal fanout for nodes in the tree or how to keep the tree balanced. Second, information hiding makes it easier to evolve the system. If a piece of information is hidden, there are no dependencies on that information outside the module containing the information, so a design change related to that information will affect only the one module. For example, if the TCP protocol changes (to introduce a new mechanism for congestion control, for instance), the protocol’s implementation will have to be modified, but no changes should be needed in higher-level code that uses TCP to send and receive data.</p><p>When designing a new module, you should think carefully about what information can be hidden in that module. If you can hide more information, you should also be able to simplify the module’s interface, and this makes the module deeper.</p><p>Note: hiding variables and methods in a class by declaring them private isn’t the same thing as information hiding. Private elements can help with information hiding, since they make it impossible for the items to be accessed directly from outside the class. However, information about the private items can still be exposed through public methods such as getter and setter methods. When this happens the nature and usage of the variables are just as exposed as if the variables were public.</p><p>The best form of information hiding is when information is totally hidden within a module, so that it is irrelevant and invisible to users of the module. However, partial information hiding also has value. For example, if a particular feature or piece of information is only needed by a few of a class’s users, and it is accessed through separate methods so that it isn’t visible in the most common use cases, then that information is mostly hidden. Such information will create fewer dependencies than information that is visible to every user of the class.</p><h2 id="_5-2-information-leakage" tabindex="-1">5.2 Information leakage <a class="header-anchor" href="#_5-2-information-leakage" aria-label="Permalink to &quot;5.2 Information leakage&quot;">​</a></h2><p>The opposite of information hiding is <em>information leakage</em>. Information leakage occurs when a design decision is reflected in multiple modules. This creates a dependency between the modules: any change to that design decision will require changes to all of the involved modules. If a piece of information is reflected in the interface for a module, then by definition it has been leaked; thus, simpler interfaces tend to correlate with better information hiding. However, information can be leaked even if it doesn’t appear in a module’s interface. Suppose two classes both have knowledge of a particular file format (perhaps one class reads files in that format and the other class writes them). Even if neither class exposes that information in its interface, they both depend on the file format: if the format changes, both classes will need to be modified. Back-door leakage like this is more pernicious than leakage through an interface, because it isn’t obvious.</p><p>Information leakage is one of the most important red flags in software design. One of the best skills you can learn as a software designer is a high level of sensitivity to information leakage. If you encounter information leakage between classes, ask yourself “How can I reorganize these classes so that this particular piece of knowledge only affects a single class?” If the affected classes are relatively small and closely tied to the leaked information, it may make sense to merge them into a single class. Another possible approach is to pull the information out of all of the affected classes and create a new class that encapsulates just that information. However, this approach will be effective only if you can find a simple interface that abstracts away from the details; if the new class exposes most of the knowledge through its interface, then it won’t provide much value (you’ve simply replaced back-door leakage with leakage through an interface).</p><p>img Red Flag: Information Leakage img</p><p>Information leakage occurs when the same knowledge is used in multiple places, such as two different classes that both understand the format of a particular type of file.</p><h2 id="_5-3-temporal-decomposition" tabindex="-1">5.3 Temporal decomposition <a class="header-anchor" href="#_5-3-temporal-decomposition" aria-label="Permalink to &quot;5.3 Temporal decomposition&quot;">​</a></h2><p>One common cause of information leakage is a design style I call <em>temporal decomposition</em>. In temporal decomposition, the structure of a system corresponds to the time order in which operations will occur. Consider an application that reads a file in a particular format, modifies the contents of the file, and then writes the file out again. With temporal decomposition, this application might be broken into three classes: one to read the file, another to perform the modifications, and a third to write out the new version. Both the file reading and file writing steps have knowledge about the file format, which results in information leakage. The solution is to combine the core mechanisms for reading and writing files into a single class. This class will get used during both the reading and writing phases of the application. It’s easy to fall into the trap of temporal decomposition, because the order in which operations must occur is often on your mind when you code. However, most design decisions manifest themselves at several different times over the life of the application; as a result, temporal decomposition often results in information leakage.</p><p>Order usually does matter, so it will be reflected somewhere in the application. However, it shouldn’t be reflected in the module structure unless that structure is consistent with information hiding (perhaps the different stages use totally different information). <strong>When designing modules, focus on the knowledge that’s needed to perform each task, not the order in which tasks occur</strong>.</p><p>img Red Flag: Temporal Decomposition img</p><p>In temporal decomposition, execution order is reflected in the code structure: operations that happen at different times are in different methods or classes. If the same knowledge is used at different points in execution, it gets encoded in multiple places, resulting in information leakage.</p><h2 id="_5-4-example-http-server" tabindex="-1">5.4 Example: HTTP server <a class="header-anchor" href="#_5-4-example-http-server" aria-label="Permalink to &quot;5.4 Example: HTTP server&quot;">​</a></h2><p>To illustrate the issues in information hiding, let’s consider the design decisions made by students implementing the HTTP protocol in a software design course. It’s useful to see both the things they did well and they areas where they had problems.</p><p>HTTP is a mechanism used by Web browsers to communicate with Web servers. When a user clicks on a link in a Web browser or submits a form, the browser uses HTTP to send a request over the network to a Web server. Once the server has processed the request, it sends a response back to the browser; the response normally contains a new Web page to display. The HTTP protocol specifies the format of requests and responses, both of which are represented textually. Figure 5.1 shows a sample HTTP request describing a form submission. The students in the course were asked to implement one or more classes to make it easy for Web servers to receive incoming HTTP requests and send responses.</p><p><img src="/a-philosophy-of-software-design/assets/00014.CH0PQhb9.gif" alt=""></p><p>Figure 5.1: A POST request in the HTTP protocol consists of text sent over a TCP socket. Each request contains an initial line, a collection of headers terminated by an empty line, and an optional body. The initial line contains the request type (POST is used for submitting form data), a URL indicating an operation (/comments/create) and optional parameters (photo_id has the value 246), and the HTTP protocol version used by the sender. Each header line consists of a name such as Content-Length followed by its value. For this request, the body contains additional parameters (comment and priority).</p><h2 id="_5-5-example-too-many-classes" tabindex="-1">5.5 Example: too many classes <a class="header-anchor" href="#_5-5-example-too-many-classes" aria-label="Permalink to &quot;5.5 Example: too many classes&quot;">​</a></h2><p>The most common mistake made by students was to divide their code into a large number of shallow classes, which led to information leakage between the classes. One team used two different classes for receiving HTTP requests; the first class read the request from the network connection into a string, and the second class parsed the string. This is an example of a temporal decomposition (“first we read the request, then we parse it”). Information leakage occurred because an HTTP request can’t be read without parsing much of the message; for example, the Content-Length header specifies the length of the request body, so the headers must be parsed in order to compute the total request length. As a result, both classes needed to understand most of the structure of HTTP requests, and parsing code was duplicated in both classes. This approach also created extra complexity for callers, who had to invoke two methods in different classes, in a particular order, to receive a request.</p><p>Because the classes shared so much information, it would have been better to merge them into a single class that handles both request reading and parsing. This provides better information hiding, since it isolates all knowledge of the request format in one class, and it also provides a simpler interface to callers (just one method to invoke).</p><p>This example illustrates a general theme in software design: <strong>information hiding can often be improved by making a class slightly larger</strong>. One reason for doing this is to bring together all of the code related to a particular capability (such as parsing an HTTP request), so that the resulting class contains everything related to that capability. A second reason for increasing the size of a class is to raise the level of the interface; for example, rather than having separate methods for each of three steps of a computation, have a single method that performs the entire computation. This can result in a simpler interface. Both of these benefits apply in the example of the previous paragraph: combining the classes brings together all of the code related to parsing an HTTP request, and it replaces two externally-visible methods with one. The combined class is deeper than the original classes.</p><p>Of course, it is possible to take the notion of larger classes too far (such as a single class for the entire application). Chapter 9 will discuss conditions under which it makes sense to separate code into multiple smaller classes.</p><h2 id="_5-6-example-http-parameter-handling" tabindex="-1">5.6 Example: HTTP parameter handling <a class="header-anchor" href="#_5-6-example-http-parameter-handling" aria-label="Permalink to &quot;5.6 Example: HTTP parameter handling&quot;">​</a></h2><p>After an HTTP request has been received by a server, the server needs to access some of the information from the request. The code that handles the request in Figure 5.1 might need to know the value of the photo_id parameter. Parameters can be specified in the first line of the request (photo_id in Figure 5.1) or, sometimes, in the body (comment and priority in Figure 5.1). Each parameter has a name and a value. The values of parameters use a special encoding called URL encoding; for example, in the value for comment in Figure 5.1, “+” is used to represent a space character, and “%21” is used instead of “!”. In order to process a request, the server will need the values for some of the parameters, and it will want them in unencoded form.</p><p>Most of the student projects made two good choices with respect to parameter handling. First, they recognized that server applications don’t care whether a parameter is specified in the header line or the body of the request, so they hid this distinction from callers and merged the parameters from both locations together. Second, they hid knowledge of URL encoding: the HTTP parser decodes parameter values before returning them to the Web server, so that the value of the comment parameter in Figure 5.1 will be returned as “What a cute baby!”, not “What+a+cute+baby%21”). In both of these cases, information hiding resulted in simpler APIs for the code using the HTTP module.</p><p>However, most of the students used an interface for returning parameters that was too shallow, and this resulted in lost opportunities for information hiding. Most projects used an object of type HTTPRequest to hold the parsed HTTP request, and the HTTPRequest class had a single method like the following one to return parameters:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String, String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.params;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Rather than returning a single parameter, the method returns a reference to the Map used internally to store all of the parameters. This method is shallow, and it exposes the internal representation used by the HTTPRequest class to store parameters. Any change to that representation will result in a change to the interface, which will require modifications to all callers. When implementations are modified, the changes often involve changes in the representation of key data structures (to improve performance, for example). Thus, it’s important to avoid exposing internal data structures as much as possible. This approach also makes more work for callers: a caller must first invoke getParams, then it must call another method to retrieve a specific parameter from the Map. Finally, callers must realize that they should not modify the Map returned by getParams, since that will affect the internal state of the HTTPRequest.</p><p>Here is a better interface for retrieving parameter values:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String name) { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getIntParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String name) { ... }</span></span></code></pre></div><p>getParameter returns a parameter value as a string. It provides a slightly deeper interface than getParams above; more importantly, it hides the internal representation of parameters. getIntParameter converts the value of a parameter from its string form in the HTTP request to an integer (e.g., the photo_id parameter in Figure 5.1). This saves the caller from having to request string-to-integer conversion separately, and hides that mechanism from the caller. Additional methods for other data types, such as getDoubleParameter, could be defined if needed. (All of these methods will throw exceptions if the desired parameter doesn’t exist, or if it can’t be converted to the requested type; the exception declarations have been omitted in the code above).</p><h2 id="_5-7-example-defaults-in-http-responses" tabindex="-1">5.7 Example: defaults in HTTP responses <a class="header-anchor" href="#_5-7-example-defaults-in-http-responses" aria-label="Permalink to &quot;5.7 Example: defaults in HTTP responses&quot;">​</a></h2><p>The HTTP projects also had to provide support for generating HTTP responses. The most common mistake students made in this area was inadequate defaults. Each HTTP response must specify an HTTP protocol version; one team required callers to specify this version explicitly when creating a response object. However, the response version must correspond to that in the request object, and the request must already be passed as an argument when sending the response (it indicates where to send the response). Thus, it makes more sense for the HTTP classes to provide the response version automatically. The caller is unlikely to know what version to specify, and if the caller does specify a value, it probably results in information leakage between the HTTP library and the caller. HTTP responses also include a Date header specifying the time when the response was sent; the HTTP library should provide a sensible default for this as well.</p><p>Defaults illustrate the principle that interfaces should be designed to make the common case as simple as possible. They are also an example of partial information hiding: in the normal case, the caller need not be aware of the existence of the defaulted item. In the rare cases where a caller needs to override a default, it will have to know about the value, and it can invoke a special method to modify it.</p><p>Whenever possible, classes should “do the right thing” without being explicitly asked. Defaults are an example of this. The Java I/O example on page 26 illustrates this point in a negative way. Buffering in file I/O is so universally desirable that noone should ever have to ask explicitly for it, or even be aware of its existence; the I/O classes should do the right thing and provide it automatically. The best features are the ones you get without even knowing they exist.</p><p>img Red Flag: Overexposure img</p><p>If the API for a commonly used feature forces users to learn about other features that are rarely used, this increases the cognitive load on users who don’t need the rarely used features.</p><h2 id="_5-8-information-hiding-within-a-class" tabindex="-1">5.8 Information hiding within a class <a class="header-anchor" href="#_5-8-information-hiding-within-a-class" aria-label="Permalink to &quot;5.8 Information hiding within a class&quot;">​</a></h2><p>The examples in this chapter focused on information hiding as it relates to the externally visible APIs for classes, but information hiding can also be applied at other levels in the system, such as within a class. Try to design the private methods within a class so that each method encapsulates some information or capability and hides it from the rest of the class. In addition, try to minimize the number of places where each instance variable is used. Some variables may need to be accessed widely across the class, but others may be needed in only a few places; if you can reduce the number of places where a variable is used, you will eliminate dependencies within the class and reduce its complexity.</p><h2 id="_5-9-taking-it-too-far" tabindex="-1">5.9 Taking it too far <a class="header-anchor" href="#_5-9-taking-it-too-far" aria-label="Permalink to &quot;5.9 Taking it too far&quot;">​</a></h2><p>Information hiding only makes sense when the information being hidden is not needed outside its module. If the information is needed outside the module, then you must not hide it. Suppose that the performance of a module is affected by certain configuration parameters, and that different uses of the module will require different settings of the parameters. In this case it is important that the parameters are exposed in the interface of the module, so that they can be turned appropriately. As a software designer, your goal should be to minimize the amount of information needed outside a module; for example, if a module can automatically adjust its configuration, that is better than exposing configuration parameters. But, it’s important to recognize which information is needed outside a module and make sure it is exposed.</p><h2 id="_5-10-conclusion" tabindex="-1">5.10 Conclusion <a class="header-anchor" href="#_5-10-conclusion" aria-label="Permalink to &quot;5.10 Conclusion&quot;">​</a></h2><p>Information hiding and deep modules are closely related. If a module hides a lot of information, that tends to increase the amount of functionality provided by the module while also reducing its interface. This makes the module deeper. Conversely, if a module doesn’t hide much information, then either it doesn’t have much functionality, or it has a complex interface; either way, the module is shallow.</p><p>When decomposing a system into modules, try not to be influenced by the order in which operations will occur at runtime; that will lead you down the path of temporal decomposition, which will result in information leakage and shallow modules. Instead, think about the different pieces of knowledge that are needed to carry out the tasks of your application, and design each module to encapsulate one or a few of those pieces of knowledge. This will produce a clean and simple design with deep modules.</p><p>1David Parnas, “On the Criteria to be Used in Decomposing Systems into Modules,” Communications of the ACM, December 1972.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/information-hiding-and-leakage.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2026-01-29T23:40:44.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/a-philosophy-of-software-design/modules-should-be-deep.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>4 模块应深厚</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/a-philosophy-of-software-design/general-purpose-modules-are-deeper.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>6 General-Purpose Modules are Deeper</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"better-together-or-better-apart.md\":\"CCC-PGqq\",\"choosing-names.md\":\"_d-7Vud_\",\"code-should-be-obvious.md\":\"BAMx6bn1\",\"comments-should-describe-things-that-are-not-obvious-from-the-code.md\":\"faEKBaFN\",\"conclusion.md\":\"0pLUwniS\",\"consistency.md\":\"BQUIxy6v\",\"decide-what-matters.md\":\"B6FZwauZ\",\"define-errors-out-of-existence.md\":\"DNCRtJvK\",\"design-it-twice.md\":\"AC_jimO2\",\"designing-for-performance.md\":\"CoerI0qK\",\"different-layer-different-abstraction.md\":\"D1X5y36Q\",\"general-purpose-modules-are-deeper.md\":\"ezdnc9QF\",\"index.md\":\"B5w1DQgc\",\"information-hiding-and-leakage.md\":\"BrAPnQBd\",\"introduction.md\":\"CSDhuJX8\",\"modifying-existing-code.md\":\"Dr8fKLOt\",\"modules-should-be-deep.md\":\"DDeFs1VY\",\"preface.md\":\"BEbX2gBG\",\"pull-complexity-downwards.md\":\"DKfV3Qfy\",\"software-trends.md\":\"D29QZI0b\",\"summary.md\":\"CRLLJO4C\",\"the-nature-of-complexity.md\":\"DM4QeyWD\",\"why-write-comments-the-four-excuses.md\":\"lvgQWQ_l\",\"working-code-is-not-enough.md\":\"DSjwdDmr\",\"write-the-comments-first.md\":\"Cpzykcm4\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"ru-RU\",\"dir\":\"ltr\",\"title\":\"Философия дизайна ПО\",\"description\":\"A VitePress site\",\"base\":\"/a-philosophy-of-software-design/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"items\":[{\"text\":\"0 前言\",\"link\":\"/preface\"},{\"text\":\"1 介绍\",\"link\":\"/introduction\"},{\"text\":\"2 复杂度的本质\",\"link\":\"/the-nature-of-complexity\"},{\"text\":\"3 可运行的代码是不够的\",\"link\":\"/working-code-is-not-enough\"},{\"text\":\"4 模块应深厚\",\"link\":\"/modules-should-be-deep\"},{\"text\":\"5 信息隐藏（和泄漏）\",\"link\":\"/information-hiding-and-leakage\"},{\"text\":\"6 General-Purpose Modules are Deeper\",\"link\":\"/general-purpose-modules-are-deeper\"},{\"text\":\"7 Different Layer, Different Abstraction\",\"link\":\"/different-layer-different-abstraction\"},{\"text\":\"8 Pull Complexity Downwards\",\"link\":\"/pull-complexity-downwards\"},{\"text\":\"9 Better Together Or Better Apart?\",\"link\":\"/better-together-or-better-apart\"},{\"text\":\"10 Define Errors Out Of Existence\",\"link\":\"/define-errors-out-of-existence\"},{\"text\":\"11 Design it Twice\",\"link\":\"/design-it-twice\"},{\"text\":\"12 Why Write Comments? The Four Excuses\",\"link\":\"/why-write-comments-the-four-excuses\"},{\"text\":\"13 Comments Should Describe Things that Aren’t Obvious from the Code\",\"link\":\"/comments-should-describe-things-that-are-not-obvious-from-the-code\"},{\"text\":\"14 Choosing Names\",\"link\":\"/choosing-names\"},{\"text\":\"15 Write The Comments First\",\"link\":\"/write-the-comments-first\"},{\"text\":\"16 Modifying Existing Code\",\"link\":\"/modifying-existing-code\"},{\"text\":\"17 Consistency\",\"link\":\"/consistency\"},{\"text\":\"18 Code Should be Obvious\",\"link\":\"/code-should-be-obvious\"},{\"text\":\"19 Software Trends\",\"link\":\"/software-trends\"},{\"text\":\"20 Designing for Performance\",\"link\":\"/designing-for-performance\"},{\"text\":\"21 Decide What Matters\",\"link\":\"/decide-what-matters\"},{\"text\":\"22 Conclusion\",\"link\":\"/conclusion\"},{\"text\":\"Summary\",\"link\":\"/summary\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Exoldy/a-philosophy-of-software-design/\"}],\"editLink\":{\"pattern\":\"https://github.com/Exoldy/a-philosophy-of-software-design/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>